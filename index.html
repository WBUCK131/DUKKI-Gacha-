<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ë¼ ê°€ì±  ì•± (ê¹€ë‘í˜„ ì»¬ë ‰ì…˜)</title>
<style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ */
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        background-color: #f4f4f9;
    }
    .container {
    background-color: #fff;
    padding: 30px 30px 100px 30px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 90%;
    max-width: 500px;
    box-sizing: border-box;
    margin-top: 20px;
}

h1 {
    color: #e53935;
    margin-top: 0;
}

/* ì½”ì¸ í‘œì‹œ ì˜ì—­ */
#coin-display {
    margin-bottom: 20px;
    padding: 10px;
    background-color: #fff8e1;
    border-radius: 8px;
    font-weight: bold;
    color: #ff9800;
    border: 1px solid #ffcc80;
}

/* ê³µí†µ í™”ë©´ ìŠ¤íƒ€ì¼ */
.screen {
    display: none;
    padding: 10px 0;
}

.screen.active {
    display: block;
}

/* ======================== ë¯¸ë‹ˆê²Œì„ ê³µí†µ ìŠ¤íƒ€ì¼ ======================== */
.game-section {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 25px;
    border-radius: 10px;
    text-align: left;
    background-color: #fcfcfc;
}
    
/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-primary, .btn-game {
    padding: 10px 20px;
    font-size: 1em;
    background-color: #ffb74d;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
    width: 100%;
    box-sizing: border-box;
}
.btn-primary:hover, .btn-game:hover {
    background-color: #ffa000;
}
    
#gacha-button { width: auto; } /* ê°€ì±  ë²„íŠ¼ì€ ë„ˆë¹„ë¥¼ ê³ ì •í•˜ì§€ ì•ŠìŒ */
    
/* ê°€ì±  ì¿¨íƒ€ì„ í‘œì‹œ ìŠ¤íƒ€ì¼ */
.cooldown-text {
    color: red;
    font-weight: bold;
    margin-top: 5px;
}

/* ======================== ì–‘í„¸ ë„ë°• ìŠ¤íƒ€ì¼ (ìƒëµ) ======================== */
.sheep-picker {
    display: flex;
    justify-content: space-around;
    margin: 15px 0;
}
.sheep-wool {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #333;
    cursor: pointer;
    transition: border-color 0.2s;
}
.sheep-wool.selected {
    border-color: #e53935;
    border-width: 4px;
}
.rainbow-colors {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    margin-top: 10px;
}
.color-option {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid #ccc;
}
.color-option.active {
    border-color: #000;
    border-width: 3px;
}
.sheep-result-display {
    margin-top: 15px;
    padding: 10px;
    border: 1px dashed #777;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
}
.color-red { background-color: #e53935; }
.color-orange { background-color: #fb8c00; }
.color-yellow { background-color: #fdd835; }
.color-green { background-color: #43a047; }
.color-blue { background-color: #1e88e5; }
.color-indigo { background-color: #3949ab; }
.color-violet { background-color: #8e24aa; }

/* ======================== ì¿µì“°ì¿µì“° ìŠ¤íƒ€ì¼ ======================== */
#kungss-challenge {
    text-align: center;
}
#kungss-target {
    font-size: 1.2em; /* 3ê°œ ë‹¨ì–´ í‘œì‹œë¥¼ ìœ„í•´ í°íŠ¸ í¬ê¸° ì¡°ì • */
    font-weight: bold;
    padding: 15px;
    margin: 15px 0;
    background-color: #e8eaf6;
    border-radius: 8px;
    min-height: 40px;
}
#kungss-timer {
    font-size: 1.2em;
    color: #e53935;
    font-weight: bold;
}
#kungss-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
}
.kungss-btn {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    flex-grow: 1;
    min-width: calc(50% - 10px); /* 2ê°œì”© ë„ìš°ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ */
    box-sizing: border-box;
    font-weight: bold;
}

/* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ (ê°€ì± , ì»¬ë ‰ì…˜, ë„¤ë¹„ê²Œì´ì…˜) (ìƒëµ) */
.collection-section { margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }
.collection-section h4 { margin-top: 0; margin-bottom: 10px; padding: 5px; background-color: #e0e0e0; border-radius: 3px; }
.collection-container { min-height: 30px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; padding: 5px; }
.character-tag { padding: 5px 10px; border-radius: 5px; font-size: 0.9em; font-weight: bold; box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); white-space: nowrap; }
.rank-N { background-color: #a0a0a0; color: white; } .rank-D { background-color: #8c8c8c; color: white; } .rank-C { background-color: #6a6a6a; color: white; }
.rank-B { background-color: #4c4c4c; color: white; } .rank-A { background-color: #1a1a1a; color: white; } .rank-R { background-color: #1e88e5; color: white; }
.rank-SR { background-color: #ffb300; color: black; border: 1px solid #ff8f00; } .rank-SSR { background-color: #e53935; color: white; border: 1px solid #c62828; }
.rank-UR { background-color: #9c27b0; color: white; border: 1px solid #7b1fa2; } .rank-LR { background-color: #d81b60; color: white; border: 1px solid #ad1457; }
.rank-M { background-color: #00bcd4; color: white; border: 1px solid #0097a7; }
.clear-btn { background-color: #bdbdbd; color: #333; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 15px; cursor: pointer; font-size: 0.9em; }
.floating-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background-color: #333; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; border-top-left-radius: 10px; border-top-right-radius: 10px; }
.nav-button { background: none; border: none; color: white; font-size: 0.9em; padding: 10px 5px; cursor: pointer; flex-grow: 1; transition: color 0.2s, background-color 0.2s; display: flex; flex-direction: column; align-items: center; }
.nav-button::before { content: 'â˜…'; font-size: 1.2em; margin-bottom: 3px; }
#nav-gacha::before { content: 'ğŸ°'; } #nav-coin::before { content: 'ğŸ’°'; } #nav-collection::before { content: 'ğŸ“š'; } #nav-settings::before { content: 'âš™ï¸'; }
.nav-button:hover, .nav-button.active { color: #ffb74d; background-color: #444; }
.nav-button.active { font-weight: bold; }
#empty-collection-message { color: #777; text-align: center; padding: 20px; }

</style>
</head>
<body>
    <div class="container">
<h1>ë‘ë¼ ê°€ì± ! ğŸœ</h1>
<div id="coin-display">
    í˜„ì¬ ì½”ì¸: <span id="coin-count">500</span> ğŸª™
</div>

<div id="gacha-screen" class="screen active">
    <h2>ë‘ë¼ ë½‘ê¸° (ì½”ì¸ 250 ì†Œëª¨)</h2>
    <p>ì£¼ì¸ê³µ 'ê¹€ë‘í˜„' ìºë¦­í„°ë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</p>
    <div id="result-display" class="result-box">
        <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>
    </div>
    <button id="gacha-button">ë‘ë¼ ë½‘ê¸° (1íšŒ)</button>
    <div id="gacha-cooldown-display" class="cooldown-text" style="display:none;"></div>
</div>

<div id="coin-screen" class="screen">
    <h2>ì½”ì¸ ë¯¸ë‹ˆê²Œì„</h2>

    <div id="sheep-game-section" class="game-section">
        <h3>ğŸ‘ ì–‘í„¸ ìƒ‰ê¹” ë§ì¶”ê¸° ë„ë°• (50ì½”ì¸)</h3>
        <p>ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì„ íƒí•œ ë’¤, ì–‘í„¸ 5ê°œì˜ ìƒ‰ì„ ì˜ˆì¸¡í•˜ì„¸ìš”!</p>
        <p>ì„ íƒí•œ ìƒ‰: <span id="selected-sheep-colors">ì—†ìŒ</span></p>

        <div class="sheep-picker" id="sheep-picker-area">
            </div>
            
        <div class="rainbow-colors" id="color-palette">
            </div>

        <div class="sheep-result-display" id="sheep-result">
            ë„ë°• ì‹œì‘ì„ ëˆ„ë¥´ì„¸ìš”.
        </div>
        <button id="start-sheep-bet-btn" class="btn-game">ë„ë°• ì‹œì‘! (50 ì½”ì¸)</button>
    </div>

    <div id="kungss-game-section" class="game-section">
        <h3>ğŸ¥ ê¹€ë‘í˜„ ì¿µì“°ì¿µì“° ê²Œì„ (5ì´ˆ ì œí•œ)</h3>
        <p>í™”ë©´ì— ëœ¨ëŠ” **3ê°œì˜ ë‹¨ì–´ ì‹œí€€ìŠ¤**ë¥¼ 5ì´ˆ ì•ˆì— ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ ì •í™•íˆ ë§ì¶”ì„¸ìš”! (3ë¼ìš´ë“œ)</p>
            
        <div id="kungss-challenge">
            <p id="kungss-status">ì¤€ë¹„</p>
            <p id="kungss-timer">ì‹œê°„: 5ì´ˆ</p>
            <div id="kungss-target">ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...</div>
                
            <div id="kungss-buttons">
                </div>
                
            <button id="start-kungss-game-btn" class="btn-game">ê²Œì„ ì‹œì‘!</button>
        </div>
    </div>
</div>

<div id="collection-screen" class="screen">
    <h2>ğŸ ë‚˜ì˜ ë‘í˜„ ì»¬ë ‰ì…˜</h2>
    <p>íšë“í•œ ëª¨ë“  ë‘í˜„ ìºë¦­í„°ë“¤ì„ ë“±ê¸‰ë³„ë¡œ í™•ì¸í•˜ì„¸ìš”!</p>
    <div id="collection-list">
        <p id="empty-collection-message">ì•„ì§ íšë“í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <button id="clear-button" class="clear-btn">ì»¬ë ‰ì…˜ ì´ˆê¸°í™”</button>
</div>

<div id="settings-screen" class="screen">
    <h2>âš™ï¸ ì•± ì„¤ì •</h2>
    <p>í˜„ì¬ëŠ” ë¹ˆ í™”ë©´ì…ë‹ˆë‹¤. í–¥í›„ ë‹¤ì–‘í•œ ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    <p style="color: #777;">(ì˜ˆ: ë°°ê²½ìŒì•…, ì•Œë¦¼ ì„¤ì • ë“±)</p>
</div>

</div>
<nav class="floating-nav">
    <button id="nav-gacha" class="nav-button active" data-screen="gacha-screen">ê°€ì± </button>
    <button id="nav-coin" class="nav-button" data-screen="coin-screen">ì½”ì¸ëª¨ìœ¼ê¸°</button>
    <button id="nav-collection" class="nav-button" data-screen="collection-screen">ì»¬ë ‰ì…˜</button>
    <button id="nav-settings" class="nav-button" data-screen="settings-screen">ì„¤ì •</button>
</nav>
<script>
    // ========================================================
    // I. ë°ì´í„° ë° ìƒìˆ˜ ì •ì˜
    // ========================================================
    // âœ… ê°€ì±  ë¹„ìš© 250ìœ¼ë¡œ ë³€ê²½
    const GACHA_COST = 250; 
    const SHEEP_BET_COST = 50;
    const USER_STATE_KEY = 'doukkiUserState';
    // âœ… ê°€ì±  ì¿¨íƒ€ì„ 1ì´ˆë¡œ ë³€ê²½
    const GACHA_COOLDOWN = 1; 

    // ë“±ê¸‰ ë° ìºë¦­í„° ì •ì˜ (ìƒˆë¡œìš´ ëª©ë¡ ë° í™•ë¥  ì ìš©)
    const RARITY_ORDER = ["M", "LR", "UR", "SSR", "SR", "R", "A", "B", "C", "D", "N"];
        
    // âœ… ìƒˆë¡œìš´ ìºë¦­í„° ëª©ë¡ê³¼ í™•ë¥  (ìš”ì²­ì— ë”°ë¼ ì„¤ì •)
    const characters = [
        // M (Myth â€“ 0.0001%)
        { name: "ë‘í˜„, ë¯¼ì´ˆì˜ ì‹ . ë‚¨ì •ë„¤ ì—†ëŠ” ì„¸ê³„ì˜ ì°½ì¡°ì.", rarity: "M", probability: 0.0001, colorClass: "rank-M" },

        // LR (Legendary Rare â€“ 0.001%)
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼, ì™•ê´€ì´ ë°˜ì§ì´ë‹ˆê¹Œ ì‹ ì„±í™”ëœ ë‘í˜„", rarity: "LR", probability: 0.001, colorClass: "rank-LR" },
        { name: "ë¯¼ì´ˆë¹› ì²œì‚¬ë¡œ ìŠ¹ì²œí•œ ë‘í˜„", rarity: "LR", probability: 0.001, colorClass: "rank-LR" },

        // UR (Ultra Rare â€“ 0.4%)
        { name: "ë²Œë ˆì™€ ë¯¼ì´ˆë¡œ ì„¸ìƒì„ êµ¬í•œ ë‘í˜„", rarity: "UR", probability: 0.1, colorClass: "rank-UR" },
        { name: "ì™¸ëŒ€ì—ì„œ ì‹ ê²©í™”ëœ ë‘í˜„", rarity: "UR", probability: 0.1, colorClass: "rank-UR" },
        { name: "ë¯¼íŠ¸ë¹› ë‚ ê°œ ë‹¨ ë‘í˜„", rarity: "UR", probability: 0.1, colorClass: "rank-UR" },
        { name: "ë©ì¹œê°œì™€ ì™•ê´€ ë‚˜ëˆ ì“°ëŠ” ë‘í˜„", rarity: "UR", probability: 0.1, colorClass: "rank-UR" },
            
        // SSR (Super Super Rare â€“ 2%)
        { name: "ë²Œë ˆì™•êµ­ ê±´êµ­ ë‘í˜„", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },
        { name: "ë¯¼ì´ˆìœ ë‹ˆë²„ìŠ¤ì˜ ì—¬ì™•", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },
        { name: "ë”ë¹™ì‡¼ì¸  1ì²œë§Œë·° ì‹ í™” ë‘í˜„", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },
        { name: "ì´ê±´ ë‚˜ì˜ ì˜ˆìˆ ì´ë‹¤ ë‘í˜„", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },
        { name: "ë©ì¹œê°œì™€ ë“€ì—£ì†¡ ë°œë§¤ ë‘í˜„", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },
        { name: "ëŒ€êµ¬ ìƒê³µì— ì™•ê´€ ë– ìˆëŠ” ë‘í˜„", rarity: "SSR", probability: 0.333333, colorClass: "rank-SSR" },

        // SR (Super Rare â€“ 10%)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ë¯¼íŠ¸ë¹› ì˜¤ë¼ ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ë²Œë ˆë°´ë“œ ë³´ì»¬ ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ì™¸ëŒ€ ì „ì„¤ì˜ ë¯¼ì´ˆì—¬ì‹  ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ë©ì¹œê°œì™€ ì „í™” ì—°ê²° ì„±ê³µ ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ë¼ ë²½í™” ì£¼ì¸ê³µ ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ë”ë¹™ì‡¼ì¸ ë¡œ ë°©ì†¡ ì¶œì—° ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ë‚¨ì •ë„¤ê°€ ì‚¬ë¼ì§„ ì„¸ìƒ ê¿ˆê¾¸ëŠ” ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
        { name: "ë¯¼ì´ˆ ì„±ì§€ìˆœë¡€ ë‘í˜„", rarity: "SR", probability: 1.25, colorClass: "rank-SR" },
            
        // R (Rare â€“ 20%)
        { name: "ë”ë¹™ì‡¼ì¸  100ë§Œë·° ë‹¬ì„± ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ì™¸ëŒ€ ì „ê´‘íŒ ë¯¼ì´ˆ ê´‘ê³  ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë²Œë ˆ ëŒ„ìŠ¤ ì±Œë¦°ì§€ ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë©ì¹œê°œ ìƒë°©ì¤‘ ì±„íŒ… ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë‚¨ì •ë„¤ ê·¼ì²˜ ê¸ˆì§€ ë²•ì•ˆ ì œì•ˆ ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ëŒ€êµ¬ ë¯¼ì´ˆ í˜ìŠ¤í‹°ë²Œ MC ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë²Œë ˆë“¤ì´ ë§Œë“  ì™•ê´€ ì“°ëŠ” ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë¯¼ì´ˆ or die ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },
        { name: "ë”ë¹™ ì¤‘ ì›ƒìŒ í„°ì§„ ë‘í˜„", rarity: "R", probability: 2.222222, colorClass: "rank-R" },

        // A (Amazing â€“ 30%)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ì™•ê´€ ë„ìš´ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë‚˜ëŠ” ë²Œë ˆì˜ ì—¬ì™•ì´ë‹¤ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ì™¸ëŒ€ ë¯¼ì´ˆì˜ ì „ì„¤ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë©ì¹œê°œì™€ í†µí™” ì„±ê³µ ì§ì „ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë”ë¹™ì‡¼ì¸  10ë§Œ ì¢‹ì•„ìš” ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë¯¼ì´ˆ í­í¬ ì•„ë˜ì—ì„œ ëª…ìƒí•˜ëŠ” ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë²Œë ˆ ì½”ìŠ¤í”„ë ˆ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ë‚¨ì •ë„¤ ëª©ì†Œë¦¬ ê°ì§€ ì°¨ë‹¨ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ëŒ€êµ¬ ê±°ë¦¬ ë¯¼ì´ˆ ë²„ìŠ¤ê´‘ê³  ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
        { name: "ì™•ê´€ë³´ë‹¤ ì†Œì¤‘í•œ ê±´ ìì¡´ì‹¬ ë‘í˜„", rarity: "A", probability: 3, colorClass: "rank-A" },
            
        // B (Better â€“ 40%)
        { name: "ë¯¼ì´ˆêµ ì°½ì‹œì ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ìƒì¼ì— ì˜ìƒ í¸ì§€ ë³´ë‚´ëŠ” ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ê°€ ì„ ìƒë‹˜â™¡ í•˜ì í­ì£¼ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë¯¼íŠ¸ë¹› ì¡°ëª… ì•„ë˜ ì¶¤ì¶”ëŠ” ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë”ë¹™ì‡¼ì¸  í¸ì§‘ ì¤‘ ê³¼ëª°ì… ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ëŒ€êµ¬ì—­ ë¯¼ì´ˆ í™ë³´ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ê³ ê°œ ìˆ™ì´ë©´ ì™•ê´€ ë–¨ì–´ì ¸ìš” ëª…ì–¸ ìŠ¤í”¼ì»¤ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ì™¸ëŒ€ ì¶•ì œì—ì„œ ë²Œë ˆ í¼ë ˆì´ë“œ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ì´ë¦„ ìƒˆê¸´ ëª©ê±¸ì´ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë¯¼ì´ˆ ìŒë£Œ í™ë³´ëŒ€ì‚¬ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ ì°¨ë‹¨ ì™„ë£Œ ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },
        { name: "ë²Œë ˆì™€ ë¸Œì´ë¡œê·¸ ì°ëŠ” ë‘í˜„", rarity: "B", probability: 3.333333, colorClass: "rank-B" },

        // C (Common+ â€“ 50%)
        { name: "ë²Œë ˆ ì¹œêµ¬ ìƒì¼ íŒŒí‹° ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë¯¼ì´ˆ ì•„ì´ìŠ¤í¬ë¦¼ í¬ì¥ ì•Œë°” ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë”ë¹™ì‡¼ì¸  ì¸ë„¤ì¼ ê³ ë¥´ëŠ” ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ì™¸ëŒ€ ë¯¼ì´ˆ ë™ì•„ë¦¬ íšŒì¥ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ê³ ê°œë¥¼ ìˆ™ì´ì§€ ë§ë¼ í˜„ìˆ˜ë§‰ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ëŒ€êµ¬ ì¹´í˜ ë¯¼ì´ˆë¼ë–¼ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë‚¨ì •ë„¤ì—ê²Œ ë¯¼ì´ˆ í­íƒ„ íˆ¬ì²™ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ì™•ê´€ì— ë¯¼ì´ˆ ì¥ì‹ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë²Œë ˆì™€ ì‚°ì±… ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë©ì¹œê°œ êµ¿ì¦ˆ ëª¨ìœ¼ëŠ” ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë”ë¹™ ëŒ€ë³¸ì— í—¤ìœ¼ì‘ ê¸ˆì§€ ì ì€ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ë‘í˜„ is love ë…¸ë˜ ë¶€ë¥´ëŠ” ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },
        { name: "ì™¸ëŒ€ ìˆ˜ì—… ì¤‘ ë²Œë ˆ ìŠ¤ì¼€ì¹˜ ë‘í˜„", rarity: "C", probability: 3.846154, colorClass: "rank-C" },

        // D (Decent â€“ 60%)
        { name: "ëŒ€êµ¬ì—ì„œ ë©ì¹œê°œ êµ¿ì¦ˆ ì‚¬ëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë²Œë ˆ ì´ëª¨í‹°ì½˜ ë§Œë“œëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë‚¨ì •ë„¤ í•„í„° ì•± ë§Œë“¤ë ¤ëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ì™¸ëŒ€ ê°•ì˜ì‹¤ì—ì„œ ì¡¸ê³  ìˆëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë¯¼ì´ˆë¼ë–¼ ë§ˆì‹œë©° ì² í•™í•˜ëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë²Œë ˆë‘ ë°¥ ë‚˜ëˆ ë¨¹ëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ê³ ê°œ ìˆ™ì˜€ë”ë‹ˆ ì™•ê´€ ë•… ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë©ì¹œê°œ ì˜ìƒ ë°˜ë³µ ì‹œì²­ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë¯¼íŠ¸ìƒ‰ íŒŒì¹´ ì…ì€ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë‚˜ ë‘ë¼ì•¼! ì™¸ì¹˜ëŠ” ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë¯¼ì´ˆ ì¼€ì´í¬ ì‹¤íŒ¨í•œ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë”ë¹™ ë…¹ìŒ ì¤‘ ì¬ì±„ê¸° ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ì™¸ëŒ€ ì”ë””ë°­ ë²Œë ˆ íƒì‚¬ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ë‚˜ëŠ” ë‚¨ì •ë„¤ê°€ ì‹«ë‹¤ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },
        { name: "ì™•ê´€ì— ìŠ¤í‹°ì»¤ ë¶™ì¸ ë‘í˜„", rarity: "D", probability: 4, colorClass: "rank-D" },

        // N (Normal â€“ 80%)
        { name: "ëŒ€êµ¬ ì§€í•˜ì² ì—ì„œ ë¯¼ì´ˆ ë¨¹ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ì™¸ëŒ€ ë§¤ì ì—ì„œ í¬ì¹´ë¦¬ ì‚¬ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë²Œë ˆí•œí…Œ ì˜¤ëŠ˜ ì–´ë• ì–´? ë¬»ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë‚¨ì •ë„¤ê°€ ì¸ì‚¬í•˜ì ë„ë§ê°€ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë”ë¹™ ì—°ìŠµí•˜ë‹¤ ì¹¨ íŠ„ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼â€¦ í˜¼ì£ë§ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ì»¤í”¼ ë“¤ê³  ë²„ìŠ¤ ë†“ì¹œ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë¯¼íŠ¸ìƒ‰ ìŠ¬ë¦¬í¼ ì‹ ì€ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ ë°”ë¼ë³´ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë©ì¹œê°œ ë°©ì†¡ ê¸°ë‹¤ë¦¬ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë²Œë ˆì•¼ ë‚˜ ë°¥ ë¨¹ì—ˆì–´? ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ì™¸ëŒ€ì—ì„œ ë²Œë ˆ í¬íš ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ì™•ê´€ ë–¨ì–´ëœ¨ë¦¬ê³  ì£¼ìš´ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë‚¨ì •ë„¤ê°€ í—¤ìœ¼ì‘ í•˜ì ê¸°ê²í•˜ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë‘í˜„ëœë“œ ìƒìƒ ì¤‘ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë”ë¹™ ëŒ€ë³¸ ì°¢ì€ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë¯¼ì´ˆëŠ” ê³¼í•™ì´ë‹¤ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë²Œë ˆì—ê²Œ í•˜ì´íŒŒì´ë¸Œ ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë¯¼ì´ˆ ìŠ¤í‹°ì»¤ ë¶™ì´ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
        { name: "ë”ë¹™ ì—°ìŠµ ì¤‘ í•˜í’ˆí•˜ëŠ” ë‘í˜„", rarity: "N", probability: 4, colorClass: "rank-N" },
    ];
        
    const totalProbability = characters.reduce((sum, char) => sum + char.probability, 0); 
        
    let userState = {
        coins: 500,
        collection: []
    };
        
    let isGachaOnCooldown = false;
    let cooldownTimerId = null;

    // ì–‘í„¸ ë„ë°• ìƒìˆ˜
    const RAINBOW_COLORS = [
        { name: "ë¹¨ê°•", class: "color-red" },
        { name: "ì£¼í™©", class: "color-orange" },
        { name: "ë…¸ë‘", class: "color-yellow" },
        { name: "ì´ˆë¡", class: "color-green" },
        { name: "íŒŒë‘", class: "color-blue" },
        { name: "ë‚¨ìƒ‰", class: "color-indigo" },
        { name: "ë³´ë¼", class: "color-violet" }
    ];
    
    // âœ…âœ…âœ… ìš”ì²­í•˜ì‹  ë³´ìƒìœ¼ë¡œ ë³€ê²½ âœ…âœ…âœ…
    const SHEEP_REWARD_MAP = {
        2: 300, 3: 2000, 4: 10000, 5: 100000
    };
    // (0-1ê°œëŠ” 0ì½”ì¸)

    // ì¿µì“°ì¿µì“° ê²Œì„ ìƒìˆ˜ (ìš”ì²­ ì‚¬í•­ ìœ ì§€)
    const KUNGSS_WORDS = ["ê¹€ë‘í˜„ì¿µìŠ¤", "ê¹€ë‘í˜„ê¸°ì¦ë‚˜ìš”", "ê¹€ë‘ë‹¤ë‹¤ì¿µ", "ê¹€ê¹€ë‘í˜„ê¹€ê¹€ë‘í˜„ë‘í˜„", "ë‚¨ì •ë„¤"];
    const KUNGSS_ROUNDS = 3;
    // âœ… ì¿µì“°ì¿µì“° ì‹œê°„ 5ì´ˆë¡œ ë³€ê²½
    const KUNGSS_TIME_LIMIT = 5; 
    const KUNGSS_REWARD = 2000;
    const KUNGSS_SEQUENCE_LENGTH = 3; 

    // ì¿µì“° ê²Œì„ ìƒíƒœ ë³€ìˆ˜ (ë™ì¼)
    let kungssCurrentRound = 0;
    let kungssTimerId = null;
    let kungssTargetSequence = []; 
    let kungssUserInput = [];      

    // ========================================================
    // II. DOM ìš”ì†Œ ì ‘ê·¼ (ë™ì¼ + ì¿¨íƒ€ì„ ìš”ì†Œ ì¶”ê°€)
    // ========================================================
    const gachaButton = document.getElementById('gacha-button');
    const gachaCooldownDisplay = document.getElementById('gacha-cooldown-display'); // ì¿¨íƒ€ì„ í‘œì‹œ DOM
    const resultDisplay = document.getElementById('result-display');
    const collectionList = document.getElementById('collection-list');
    const coinCountElement = document.getElementById('coin-count');
    const screens = document.querySelectorAll('.screen');
    const navButtons = document.querySelectorAll('.nav-button');
    const emptyCollectionMessage = document.getElementById('empty-collection-message');
        
    // ì–‘í„¸ ë„ë°• DOM (ë™ì¼)
    const sheepPickerArea = document.getElementById('sheep-picker-area');
    const colorPalette = document.getElementById('color-palette');
    const startSheepBetBtn = document.getElementById('start-sheep-bet-btn');
    const sheepResult = document.getElementById('sheep-result');
    const selectedSheepColorsDisplay = document.getElementById('selected-sheep-colors');

    // ì¿µì“°ì¿µì“° DOM (ë™ì¼)
    const startKungssGameBtn = document.getElementById('start-kungss-game-btn');
    const kungssTarget = document.getElementById('kungss-target');
    const kungssButtons = document.getElementById('kungss-buttons');
    const kungssTimer = document.getElementById('kungss-timer');
    const kungssStatus = document.getElementById('kungss-status');
        

    // ========================================================
    // III. ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ (ë™ì¼)
    // ========================================================

    function loadUserState() {
        const data = localStorage.getItem(USER_STATE_KEY);
        if (data) {
            const loadedState = JSON.parse(data);
            userState = { ...userState, ...loadedState };
        }
    }

    function saveUserState() {
        localStorage.setItem(USER_STATE_KEY, JSON.stringify(userState));
    }

    function updateCoinDisplay() {
        coinCountElement.textContent = userState.coins;
    }

    function addCoin(amount) {
        userState.coins += amount;
        saveUserState();
        updateCoinDisplay();
    }

    function subtractCoin(amount) {
        if (userState.coins < amount) {
            return false;
        }
        userState.coins -= amount;
        saveUserState();
        updateCoinDisplay();
        return true;
    }

    // ========================================================
    // IV. ê°€ì± /ì»¬ë ‰ì…˜ ë¡œì§ (ì¿¨íƒ€ì„ ë¡œì§ ì¶”ê°€)
    // ========================================================

    function conductGacha() { 
        const randomValue = Math.random() * totalProbability;
        let cumulativeProbability = 0;
        for (const char of characters) {
            cumulativeProbability += char.probability;
            if (randomValue < cumulativeProbability) { return char; }
        }
        return characters[0]; 
    }

    function startGachaCooldown() {
        if (cooldownTimerId) clearInterval(cooldownTimerId);
            
        isGachaOnCooldown = true;
        gachaButton.disabled = true;
        gachaCooldownDisplay.style.display = 'block';

        let timeLeft = GACHA_COOLDOWN;
        gachaCooldownDisplay.textContent = `ì¿¨íƒ€ì„: ${timeLeft}ì´ˆ...`;

        cooldownTimerId = setInterval(() => {
            timeLeft--;
            gachaCooldownDisplay.textContent = `ì¿¨íƒ€ì„: ${timeLeft}ì´ˆ...`;

            if (timeLeft <= 0) {
                clearInterval(cooldownTimerId);
                isGachaOnCooldown = false;
                gachaButton.disabled = false;
                gachaCooldownDisplay.style.display = 'none';
                gachaCooldownDisplay.textContent = '';
            }
        }, 1000);
    }

    function handleGacha() {
        if (isGachaOnCooldown) {
            resultDisplay.innerHTML = '<p style="color: red;">â³ ì ì‹œë§Œìš”! ì¿¨íƒ€ì„ ì¤‘ì…ë‹ˆë‹¤.</p>';
            return;
        }

        if (!subtractCoin(GACHA_COST)) {
            resultDisplay.innerHTML = `<p style="color: red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${GACHA_COST})</p>`;
            return;
        }
            
        startGachaCooldown(); // ì¿¨íƒ€ì„ ì‹œì‘

        const pulledCharacter = conductGacha();
        resultDisplay.innerHTML = `
            ğŸ‰ **ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸ‰<br>
            <span class="character-tag ${pulledCharacter.colorClass}">${pulledCharacter.rarity}</span> 
            **${pulledCharacter.name}**ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!
        `;
        userState.collection.push(pulledCharacter.name);
        saveUserState();
    }

    function displayCollection() { 
        const collection = userState.collection;
        collectionList.innerHTML = ''; 

        if (collection.length === 0) {
            emptyCollectionMessage.style.display = 'block';
            return;
        } else {
            emptyCollectionMessage.style.display = 'none';
        }

        const countsByRarity = {};
        RARITY_ORDER.forEach(rarity => { countsByRarity[rarity] = []; });
            
        collection.forEach(name => {
            const charInfo = characters.find(c => c.name === name);
            if (charInfo) {
                const existing = countsByRarity[charInfo.rarity].find(item => item.name === name);
                if (existing) { existing.count++; } 
                else { countsByRarity[charInfo.rarity].push({ name: name, count: 1, colorClass: charInfo.colorClass }); }
            }
        });

        RARITY_ORDER.forEach(rarity => {
            const charList = countsByRarity[rarity];
            if (charList && charList.length > 0) {
                const sectionDiv = document.createElement('div');
                sectionDiv.classList.add('collection-section');
                const title = document.createElement('h4');
                title.textContent = `${rarity} ë“±ê¸‰ (ì´ ${charList.reduce((sum, item) => sum + item.count, 0)}ê°œ)`;
                sectionDiv.appendChild(title);
                const container = document.createElement('div');
                container.classList.add('collection-container');

                charList.forEach(item => {
                    const tag = document.createElement('span');
                    tag.classList.add('character-tag', item.colorClass);
                    tag.textContent = `${item.name} (x${item.count})`;
                    container.appendChild(tag);
                });

                sectionDiv.appendChild(container);
                collectionList.appendChild(sectionDiv);
            }
        });
    }

    function clearCollection() { 
        if (confirm("ì •ë§ë¡œ ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ëœ ëª¨ë“  ìºë¦­í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.")) {
            userState.collection = [];
            userState.coins = 500;
            saveUserState();
            updateCoinDisplay();
            displayCollection();
            document.getElementById('result-display').innerHTML = '<p>ì»¬ë ‰ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë½‘ê¸°ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.</p>';
        }
    }
        
    // ========================================================
    // V. ì–‘í„¸ ë„ë°• ë¡œì§ (ë™ì¼)
    // ========================================================

    let userSheepPicks = new Array(5).fill(null); 
    let selectedColor = RAINBOW_COLORS[0].name; 

    function initSheepGame() {
        // 1. ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„±
        colorPalette.innerHTML = '';
        RAINBOW_COLORS.forEach(color => {
            const option = document.createElement('div');
            option.classList.add('color-option', color.class);
            option.dataset.color = color.name;
            option.addEventListener('click', () => { selectColorOption(color.name, option); });
            colorPalette.appendChild(option);
        });
        selectColorOption(RAINBOW_COLORS[0].name, colorPalette.firstChild);

        // 2. ì–‘í„¸ í”½ì»¤ ìƒì„±
        sheepPickerArea.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const sheep = document.createElement('div');
            sheep.classList.add('sheep-wool');
            sheep.dataset.index = i;
            sheep.addEventListener('click', () => { selectSheepColor(i, sheep); });
            sheepPickerArea.appendChild(sheep);
        }
            
        // 3. ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        userSheepPicks.fill(null);
        updateSheepDisplay();
        sheepResult.textContent = 'ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì–‘í„¸ì— ì„ íƒí•´ ì£¼ì„¸ìš”.';
    }
        
    function selectColorOption(colorName, element) {
        document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        selectedColor = colorName;
    }

    function selectSheepColor(index, sheepElement) {
        userSheepPicks[index] = selectedColor;
            
        sheepElement.className = 'sheep-wool selected'; 
        const colorData = RAINBOW_COLORS.find(c => c.name === selectedColor);
        if (colorData) {
            sheepElement.classList.add(colorData.class);
        }
            
        updateSheepDisplay();
    }

    function updateSheepDisplay() {
        const displayNames = userSheepPicks.map(name => name ? name : '??');
        selectedSheepColorsDisplay.textContent = displayNames.join(', ');
            
        document.querySelectorAll('.sheep-wool').forEach((sheep, index) => {
            const selected = userSheepPicks[index];
            sheep.className = 'sheep-wool';
            if (selected) {
                sheep.classList.add('selected');
                const colorData = RAINBOW_COLORS.find(c => c.name === selected);
                if (colorData) {
                    sheep.classList.add(colorData.class);
                }
            }
        });
    }

    function startSheepBet() {
        if (!subtractCoin(SHEEP_BET_COST)) {
            sheepResult.innerHTML = `<span style="color:red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${SHEEP_BET_COST})</span>`;
            return;
        }

        if (userSheepPicks.includes(null)) {
            addCoin(SHEEP_BET_COST); 
            sheepResult.innerHTML = '<span style="color:red;">âŒ 5ê°œì˜ ì–‘í„¸ ìƒ‰ê¹”ì„ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.</span>';
            return;
        }

        const randomResult = [];
        for (let i = 0; i < 5; i++) {
            const randomIndex = Math.floor(Math.random() * RAINBOW_COLORS.length);
            randomResult.push(RAINBOW_COLORS[randomIndex].name);
        }

        let matchedCount = 0;
        for (let i = 0; i < 5; i++) {
            if (userSheepPicks[i] === randomResult[i]) {
                matchedCount++;
            }
        }

        sheepResult.innerHTML = `
            <p>ë‹¹ì‹ ì˜ ì„ íƒ: ${userSheepPicks.join(', ')}</p>
            <p>ëœë¤ ê²°ê³¼: ${randomResult.join(', ')}</p>
            <p style="font-size: 1.3em; margin: 10px 0;">âœ… **${matchedCount}ê°œ** ì¼ì¹˜!</p>
        `;

        // âœ…âœ…âœ… ë³€ê²½ëœ ë³´ìƒ ë§µ ì‚¬ìš© âœ…âœ…âœ…
        let reward = SHEEP_REWARD_MAP[matchedCount] || 0; 
        let resultText = '';

        if (reward > 0) {
            addCoin(reward);
            resultText = `<span style="color: green; font-weight: bold;">ğŸ‰ ìŠ¹ë¦¬! ${reward} ì½”ì¸ íšë“! (í˜„ì¬ ${userState.coins})</span>`;
        } else {
            resultText = `<span style="color: red; font-weight: bold;">ğŸ˜­ íŒ¨ë°°! ${SHEEP_BET_COST} ì½”ì¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ${userState.coins})</span>`;
        }

        sheepResult.innerHTML += resultText;
            
        document.querySelectorAll('.sheep-wool').forEach((sheep, index) => {
            const resultColorName = randomResult[index];
            const resultColorData = RAINBOW_COLORS.find(c => c.name === resultColorName);
                
            sheep.className = 'sheep-wool selected'; 
            sheep.classList.add(resultColorData.class);
                
            if (userSheepPicks[index] === randomResult[index]) {
                sheep.style.border = '4px solid gold';
            } else {
                sheep.style.border = '4px solid red';
            }
        });
        setTimeout(() => {
            document.querySelectorAll('.sheep-wool').forEach(s => s.style.border = '4px solid #333');
        }, 3000); 
    }

    // ========================================================
    // VI. ì¿µì“°ì¿µì“° ê²Œì„ ë¡œì§ (ë‹¨ì–´ 3ê°œ ìˆœì„œ ë§ì¶”ê¸° - ì‹œê°„ 5ì´ˆë¡œ ë³€ê²½)
    // ========================================================

    function initKungssGame() {
        resetKungssGame();
    }

    function resetKungssGame() {
        kungssCurrentRound = 0;
        kungssTargetSequence = [];
        kungssUserInput = [];
        kungssStatus.textContent = `ì¤€ë¹„ (ì´ ${KUNGSS_ROUNDS} ë¼ìš´ë“œ, ë‹¨ì–´ 3ê°œ ìˆœì„œ ì…ë ¥)`;
        // âœ… KUNGSS_TIME_LIMIT ë³€ìˆ˜ ì‚¬ìš©
        kungssTimer.textContent = `ì‹œê°„: ${KUNGSS_TIME_LIMIT}ì´ˆ`; 
        kungssTarget.textContent = 'ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...';
        startKungssGameBtn.disabled = false;
        kungssButtons.innerHTML = ''; 
    }

    function startKungssGame() {
        startKungssGameBtn.disabled = true;
        kungssCurrentRound = 0;
        runKungssRound();
    }

    function runKungssRound() {
        kungssCurrentRound++;
        if (kungssCurrentRound > KUNGSS_ROUNDS) {
            // ê²Œì„ ì„±ê³µ
            clearTimeout(kungssTimerId);
            addCoin(KUNGSS_REWARD);
            kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">ğŸ‰ 3ë¼ìš´ë“œ ì„±ê³µ! ${KUNGSS_REWARD} ì½”ì¸ íšë“!</span>`;
            kungssTarget.textContent = 'ê²Œì„ ìŠ¹ë¦¬!';
            kungssButtons.innerHTML = '';
            setTimeout(resetKungssGame, 3000);
            return;
        }

        // ë¼ìš´ë“œ ì¤€ë¹„
        kungssUserInput = []; 
        kungssStatus.textContent = `ë¼ìš´ë“œ ${kungssCurrentRound} / ${KUNGSS_ROUNDS} (ì…ë ¥ 0/${KUNGSS_SEQUENCE_LENGTH})`;

        // 1. ëœë¤ ë‹¨ì–´ ì‹œí€€ìŠ¤ 3ê°œ ì„ íƒ (ì •ë‹µ)
        let sequence = [];
        for (let i = 0; i < KUNGSS_SEQUENCE_LENGTH; i++) {
            const randomIndex = Math.floor(Math.random() * KUNGSS_WORDS.length);
            sequence.push(KUNGSS_WORDS[randomIndex]);
        }
        kungssTargetSequence = sequence;
        kungssTarget.textContent = `â–¶ï¸ ${kungssTargetSequence.join(' | ')} â—€ï¸`; 

        // 2. ë²„íŠ¼ì— í‘œì‹œë  ë‹¨ì–´ 4ê°œ ì„ íƒ (ì •ë‹µ 3ê°œ + ì˜¤ë‹µ 1ê°œ)
        let buttonWords = [...new Set(kungssTargetSequence)]; 

        // ì˜¤ë‹µ ë‹¨ì–´ 1ê°œ ì¶”ê°€
        let availableMissWords = KUNGSS_WORDS.filter(word => !kungssTargetSequence.includes(word));
        if (availableMissWords.length > 0 && buttonWords.length < 4) {
            const randomMissIndex = Math.floor(Math.random() * availableMissWords.length);
            buttonWords.push(availableMissWords[randomMissIndex]);
        }
            
        // ë²„íŠ¼ ê°œìˆ˜ê°€ 4ê°œ ë¯¸ë§Œì¸ ê²½ìš° (ë‹¨ì–´ ëª©ë¡ì´ ì ì„ ë•Œ) ëŒ€ë¹„: ë‹¤ë¥¸ ë‹¨ì–´ë¥¼ ì¤‘ë³µí•´ì„œ ì¶”ê°€
        while(buttonWords.length < 4 && KUNGSS_WORDS.length >= 4) {
            const randomIndex = Math.floor(Math.random() * KUNGSS_WORDS.length);
            const wordToAdd = KUNGSS_WORDS[randomIndex];
            if (!buttonWords.includes(wordToAdd)) {
                 buttonWords.push(wordToAdd);
            }
        }

        // 3. ë‹¨ì–´ ìˆœì„œ ì„ê¸° (ë²„íŠ¼ ìœ„ì¹˜ ë¬´ì‘ìœ„í™”)
        buttonWords.sort(() => Math.random() - 0.5);

        // 4. ë²„íŠ¼ ì˜ì—­ ì—…ë°ì´íŠ¸ ë° í™œì„±í™”
        kungssButtons.innerHTML = '';
        buttonWords.forEach(word => {
            const btn = document.createElement('button');
            btn.classList.add('kungss-btn');
            btn.textContent = word;
            btn.dataset.word = word;
            btn.disabled = false; 
            btn.addEventListener('click', handleKungssButtonClick);
            kungssButtons.appendChild(btn);
        });

        // 5. íƒ€ì´ë¨¸ ì‹œì‘
        let timeLeft = KUNGSS_TIME_LIMIT; // âœ… 5ì´ˆ ì‹œì‘
        kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;

        clearTimeout(kungssTimerId);
        kungssTimerId = setInterval(() => {
            timeLeft--;
            kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;
            if (timeLeft <= 0) {
                // ì‹œê°„ ì´ˆê³¼
                clearInterval(kungssTimerId);
                failKungssGame(`ì‹œê°„ ì´ˆê³¼! ì •ë‹µì€ "${kungssTargetSequence.join(' | ')}"ì˜€ìŠµë‹ˆë‹¤.`);
            }
        }, 1000);
    }

    function handleKungssButtonClick(event) {
        const clickedWord = event.currentTarget.dataset.word;
            
        // 1. ì‚¬ìš©ìê°€ ëˆ„ë¥¸ ë‹¨ì–´ ì…ë ¥ ë°°ì—´ì— ì¶”ê°€
        kungssUserInput.push(clickedWord);
            
        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        kungssStatus.textContent = `ì…ë ¥ ì¤‘: ${kungssUserInput.length} / ${KUNGSS_SEQUENCE_LENGTH}`;

        // 2. 3ê°œ ë‹¨ì–´ë¥¼ ëª¨ë‘ ì…ë ¥í–ˆì„ ê²½ìš° ë¹„êµ
        if (kungssUserInput.length >= KUNGSS_SEQUENCE_LENGTH) {
            clearInterval(kungssTimerId);
            kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true); 

            const userInputStr = kungssUserInput.join(' | ');
            const targetStr = kungssTargetSequence.join(' | ');
                
            if (userInputStr === targetStr) {
                // ì •ë‹µ!
                kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">âœ… ë¼ìš´ë“œ ${kungssCurrentRound} ì„±ê³µ!</span>`;
                kungssTarget.textContent = 'ì •ë‹µ ì‹œí€€ìŠ¤ ì…ë ¥ ì„±ê³µ!';
                setTimeout(runKungssRound, 1500); 
            } else {
                // ì˜¤ë‹µ
                failKungssGame(`í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ "${targetStr}"ì˜€ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì…ë ¥ì€ "${userInputStr}"ì˜€ìŠµë‹ˆë‹¤.`);
            }
        }
        // 3ê°œë¥¼ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë‹¤ìŒ ì…ë ¥ì„ ê¸°ë‹¤ë¦¼ (íƒ€ì´ë¨¸ëŠ” ê³„ì† ì§„í–‰)
    }

    function failKungssGame(message) {
        clearInterval(kungssTimerId);
        kungssStatus.innerHTML = `<span style="color: red; font-weight: bold;">ğŸ˜­ ê²Œì„ ì‹¤íŒ¨</span>`;
        kungssTarget.textContent = message;
        kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true);
        setTimeout(resetKungssGame, 3000); 
    }

    // ========================================================
    // VII. í™”ë©´ ì „í™˜ ë° ì´ˆê¸°í™” (ë™ì¼)
    // ========================================================

    function switchScreen(screenId) {
        screens.forEach(screen => { screen.classList.remove('active'); });
        const activeScreen = document.getElementById(screenId);
        if (activeScreen) { activeScreen.classList.add('active'); }

        navButtons.forEach(button => {
            button.classList.toggle('active', button.dataset.screen === screenId);
        });

        if (screenId === 'collection-screen') { displayCollection(); }
        if (screenId === 'coin-screen') { 
            initSheepGame();
            resetKungssGame(); 
        }
    }

    function handleNavClick(event) {
        const screenId = event.currentTarget.dataset.screen;
        switchScreen(screenId);
    }

    function initializeApp() {
        loadUserState();
        updateCoinDisplay();
            
        // âœ… ê°€ì±  ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë³€ê²½ ì—†ìŒ (ì¿¨íƒ€ì„ ë¡œì§ë§Œ ì¶”ê°€ë¨)
        gachaButton.addEventListener('click', handleGacha); 
        document.getElementById('clear-button').addEventListener('click', clearCollection);
        startSheepBetBtn.addEventListener('click', startSheepBet);
        startKungssGameBtn.addEventListener('click', startKungssGame);

        navButtons.forEach(button => {
            button.addEventListener('click', handleNavClick);
        });

        initSheepGame();
        initKungssGame();
            
        switchScreen('gacha-screen');
    }

    window.onload = initializeApp;
</script>
</body>
</html>