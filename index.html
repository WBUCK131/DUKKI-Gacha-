<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ë¼ ê°€ì±  ì•± (ê¹€ë‘í˜„ ì»¬ë ‰ì…˜)</title>
<style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ */
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        background-color: #f4f4f9;
    }
    .container {
    background-color: #fff;
    padding: 30px 30px 100px 30px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 90%;
    max-width: 500px;
    box-sizing: border-box;
    margin-top: 20px;
}

h1 {
    color: #e53935;
    margin-top: 0;
}

/* ì½”ì¸ í‘œì‹œ ì˜ì—­ */
#coin-display {
    margin-bottom: 20px;
    padding: 10px;
    background-color: #fff8e1;
    border-radius: 8px;
    font-weight: bold;
    color: #ff9800;
    border: 1px solid #ffcc80;
}

/* ê³µí†µ í™”ë©´ ìŠ¤íƒ€ì¼ */
.screen {
    display: none;
    padding: 10px 0;
}

.screen.active {
    display: block;
}

/* ======================== ë¯¸ë‹ˆê²Œì„ ê³µí†µ ìŠ¤íƒ€ì¼ ======================== */
.game-section {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 25px;
    border-radius: 10px;
    text-align: left;
    background-color: #fcfcfc;
}
    
/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-primary, .btn-game {
    padding: 10px 20px;
    font-size: 1em;
    background-color: #ffb74d;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
    width: 100%;
    box-sizing: border-box;
}
.btn-primary:hover, .btn-game:hover {
    background-color: #ffa000;
}
    
#gacha-button { width: auto; } /* ê°€ì±  ë²„íŠ¼ì€ ë„ˆë¹„ë¥¼ ê³ ì •í•˜ì§€ ì•ŠìŒ */
    
/* [ì‚­ì œ] ê°€ì±  ì¿¨íƒ€ì„ í‘œì‹œ ìŠ¤íƒ€ì¼ */
/*
.cooldown-text {
    color: red;
    font-weight: bold;
    margin-top: 5px;
}
*/

/* ======================== [ì‹ ê·œ] ê°€ì±  ì• ë‹ˆë©”ì´ì…˜ ======================== */
.gacha-animation-container {
    height: 100px;
    border: 2px solid #e53935;
    background-color: #333;
    overflow: hidden;
    position: relative;
    margin: 15px 0;
    border-radius: 10px;
    display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
    box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}

/* ê°€ì§œ 'ì„ íƒ' ë¼ì¸ */
.gacha-animation-container::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background-color: rgba(255, 255, 0, 0.8);
    transform: translateY(-50%);
    z-index: 10;
}

.gacha-reel {
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease-out; /* ë¶€ë“œëŸ½ê²Œ ë©ˆì¶”ê¸° ìœ„í•œ transition */
}

.gacha-item {
    padding: 5px 10px;
    font-size: 0.9em;
    font-weight: bold;
    white-space: nowrap;
    margin: 5px 0;
    width: 80%;
    text-align: center;
    box-sizing: border-box;
    height: 26px; /* ë†’ì´ ê³ ì • */
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes spinReel {
    from {
        transform: translateY(0);
    }
    to {
        /* (ì•„ì´í…œ ë†’ì´ 26px + ë§ˆì§„ 10px) * 50ê°œ = 1800px. ìŠ¤í¬ë¡¤í•  ì´ ë†’ì´. */
        transform: translateY(-1800px); 
    }
}

.gacha-reel.spinning {
    /* 2.5ì´ˆ ë™ì•ˆ, ê°€ì†ë„ ë¶™ë‹¤ê°€ ëŠë ¤ì§€ëŠ” íš¨ê³¼ë¡œ ìŠ¤í•€ */
    animation: spinReel 2.5s cubic-bezier(0.5, 0, 0.5, 1);
}

/* ======================== ì–‘í„¸ ë„ë°• ìŠ¤íƒ€ì¼ (ìƒëµ) ======================== */
.sheep-picker {
    display: flex;
    justify-content: space-around;
    margin: 15px 0;
}
.sheep-wool {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #333;
    cursor: pointer;
    transition: border-color 0.2s;
}
.sheep-wool.selected {
    border-color: #e53935;
    border-width: 4px;
}
.rainbow-colors {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    margin-top: 10px;
}
.color-option {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid #ccc;
}
.color-option.active {
    border-color: #000;
    border-width: 3px;
}
.sheep-result-display {
    margin-top: 15px;
    padding: 10px;
    border: 1px dashed #777;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
}
.color-red { background-color: #e53935; }
.color-orange { background-color: #fb8c00; }
.color-yellow { background-color: #fdd835; }
.color-green { background-color: #43a047; }
.color-blue { background-color: #1e88e5; }
.color-indigo { background-color: #3949ab; }
.color-violet { background-color: #8e24aa; }

/* ======================== ì¿µì“°ì¿µì“° ìŠ¤íƒ€ì¼ ======================== */
#kungss-challenge {
    text-align: center;
}
#kungss-target {
    font-size: 1.2em; /* 3ê°œ ë‹¨ì–´ í‘œì‹œë¥¼ ìœ„í•´ í°íŠ¸ í¬ê¸° ì¡°ì • */
    font-weight: bold;
    padding: 15px;
    margin: 15px 0;
    background-color: #e8eaf6;
    border-radius: 8px;
    min-height: 40px;
}
#kungss-timer {
    font-size: 1.2em;
    color: #e53935;
    font-weight: bold;
}
#kungss-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
}
.kungss-btn {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    flex-grow: 1;
    min-width: calc(50% - 10px); /* 2ê°œì”© ë„ìš°ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ */
    box-sizing: border-box;
    font-weight: bold;
}

/* ======================== ê°•í™” ìŠ¤íƒ€ì¼ ======================== */
#sword-display {
    padding: 15px;
    background-color: #e8f5e9; /* ë¯¼ì´ˆ ëŠë‚Œ */
    border: 1px solid #a5d6a7;
    border-radius: 8px;
    margin-bottom: 20px;
}
#sword-display h3 {
    color: #00796b; /* Dark mint */
    margin: 5px 0 0 0;
}
#enhance-result {
    font-weight: bold;
    min-height: 40px;
    padding: 10px;
    border: 1px dashed #ccc;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
}
#next-level-info {
    text-align: left;
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 5px;
    border: 1px solid #eee;
}
.protection-toggle {
    margin-top: 20px;
    background-color: #fffde7;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #fff9c4;
}
.protection-toggle label {
    cursor: pointer;
    font-weight: bold;
    color: #f57f17;
}

/* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ (ê°€ì± , ì»¬ë ‰ì…˜, ë„¤ë¹„ê²Œì´ì…˜) (ìƒëµ) */
.collection-section { margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }
.collection-section h4 { margin-top: 0; margin-bottom: 10px; padding: 5px; background-color: #e0e0e0; border-radius: 3px; }
.collection-container { min-height: 30px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; padding: 5px; }
.character-tag { padding: 5px 10px; border-radius: 5px; font-size: 0.9em; font-weight: bold; box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); white-space: nowrap; }
/* [ìˆ˜ì •] ê°€ì±  ì•„ì´í…œì—ë„ ì ìš©ë˜ë„ë¡ .gacha-itemì—ë„ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.rank-N, .gacha-item.rank-N { background-color: #a0a0a0; color: white; }
.rank-D, .gacha-item.rank-D { background-color: #8c8c8c; color: white; }
.rank-C, .gacha-item.rank-C { background-color: #6a6a6a; color: white; }
.rank-B, .gacha-item.rank-B { background-color: #4c4c4c; color: white; }
.rank-A, .gacha-item.rank-A { background-color: #1a1a1a; color: white; }
.rank-R, .gacha-item.rank-R { background-color: #1e88e5; color: white; }
.rank-SR, .gacha-item.rank-SR { background-color: #ffb300; color: black; border: 1px solid #ff8f00; }
.rank-SSR, .gacha-item.rank-SSR { background-color: #e53935; color: white; border: 1px solid #c62828; }
.rank-UR, .gacha-item.rank-UR { background-color: #9c27b0; color: white; border: 1px solid #7b1fa2; }
.rank-LR, .gacha-item.rank-LR { background-color: #d81b60; color: white; border: 1px solid #ad1457; }
.rank-M, .gacha-item.rank-M { background-color: #00bcd4; color: white; border: 1px solid #0097a7; }
/* --- */
.clear-btn { background-color: #bdbdbd; color: #333; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 15px; cursor: pointer; font-size: 0.9em; }
.floating-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background-color: #333; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; border-top-left-radius: 10px; border-top-right-radius: 10px; }
.nav-button { background: none; border: none; color: white; font-size: 0.9em; padding: 10px 5px; cursor: pointer; flex-grow: 1; transition: color 0.2s, background-color 0.2s; display: flex; flex-direction: column; align-items: center; }
.nav-button::before { content: 'â˜…'; font-size: 1.2em; margin-bottom: 3px; }
#nav-gacha::before { content: 'ğŸ°'; } 
#nav-coin::before { content: 'ğŸ’°'; } 
#nav-collection::before { content: 'ğŸ“š'; } 
#nav-enhance::before { content: 'âš”ï¸'; } /* ê°•í™” ì•„ì´ì½˜ */
#nav-settings::before { content: 'âš™ï¸'; }
.nav-button:hover, .nav-button.active { color: #ffb74d; background-color: #444; }
.nav-button.active { font-weight: bold; }
#empty-collection-message { color: #777; text-align: center; padding: 20px; }

/* ======================== [ì¶”ê°€] ì„¤ì • í™”ë©´ ìŠ¤íƒ€ì¼ ======================== */
.settings-group {
    margin-top: 25px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    text-align: left;
}
.settings-group h3 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}
textarea.backup-restore {
    width: 100%;
    min-height: 80px;
    box-sizing: border-box; /* ë„ˆë¹„ 100% ìœ ì§€ë¥¼ ìœ„í•´ */
    margin-top: 10px;
    font-family: monospace;
    font-size: 0.9em;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}
#settings-status {
    margin-top: 15px;
    font-weight: bold;
    min-height: 20px;
}
.btn-setting {
    padding: 8px 15px;
    font-size: 0.9em;
    background-color: #555;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
    width: auto; /* ìë™ ë„ˆë¹„ */
    margin-right: 10px; /* ë²„íŠ¼ ê°„ ê°„ê²© */
}
.btn-setting.restore {
    background-color: #e53935; /* ë¹¨ê°„ìƒ‰ */
}
.btn-setting:hover {
    background-color: #000;
}
.btn-setting.restore:hover {
    background-color: #c62828;
}

</style>
</head>
<body>
    <div class="container">
<h1>ë‘ë¼ ê°€ì± ! ğŸœ</h1>
<div id="coin-display">
    í˜„ì¬ ì½”ì¸: <span id="coin-count">500</span> ğŸª™
</div>

<div id="gacha-screen" class="screen active">
    <h2>ë‘ë¼ ë½‘ê¸° (ì½”ì¸ 250 ì†Œëª¨)</h2>
    <p>ì£¼ì¸ê³µ 'ê¹€ë‘í˜„' ìºë¦­í„°ë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</p>
    
    <div id="gacha-animation-container" class="gacha-animation-container">
        <div id="gacha-reel" class="gacha-reel"></div>
    </div>
    
    <div id="result-display" class="result-box">
        <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>
    </div>
    <button id="gacha-button">ë‘ë¼ ë½‘ê¸° (1íšŒ)</button>
    </div>

<div id="coin-screen" class="screen">
    <h2>ì½”ì¸ ë¯¸ë‹ˆê²Œì„</h2>

    <div id="sheep-game-section" class="game-section">
        <h3>ğŸ‘ ì–‘í„¸ ìƒ‰ê¹” ë§ì¶”ê¸° ë„ë°• (50ì½”ì¸)</h3>
        <p>ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì„ íƒí•œ ë’¤, ì–‘í„¸ 5ê°œì˜ ìƒ‰ì„ ì˜ˆì¸¡í•˜ì„¸ìš”!</p>
        <p>ì„ íƒí•œ ìƒ‰: <span id="selected-sheep-colors">ì—†ìŒ</span></p>

        <div class="sheep-picker" id="sheep-picker-area">
            </div>
            
        <div class="rainbow-colors" id="color-palette">
            </div>

        <div class="sheep-result-display" id="sheep-result">
            ë„ë°• ì‹œì‘ì„ ëˆ„ë¥´ì„¸ìš”.
        </div>
        <button id="start-sheep-bet-btn" class="btn-game">ë„ë°• ì‹œì‘! (50 ì½”ì¸)</button>
    </div>

    <div id="kungss-game-section" class="game-section">
        <h3>ğŸ¥ ê¹€ë‘í˜„ ì¿µì“°ì¿µì“° ê²Œì„ (5ì´ˆ ì œí•œ)</h3>
        <p>í™”ë©´ì— ëœ¨ëŠ” **3ê°œì˜ ë‹¨ì–´ ì‹œí€€ìŠ¤**ë¥¼ 5ì´ˆ ì•ˆì— ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ ì •í™•íˆ ë§ì¶”ì„¸ìš”! (3ë¼ìš´ë“œ)</p>
            
        <div id="kungss-challenge">
            <p id="kungss-status">ì¤€ë¹„</p>
            <p id="kungss-timer">ì‹œê°„: 5ì´ˆ</p>
            <div id="kungss-target">ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...</div>
                
            <div id="kungss-buttons">
                </div>
                
            <button id="start-kungss-game-btn" class="btn-game">ê²Œì„ ì‹œì‘!</button>
        </div>
    </div>
</div>

<div id="collection-screen" class="screen">
    <h2>ğŸ ë‚˜ì˜ ë‘í˜„ ì»¬ë ‰ì…˜</h2>
    <p>íšë“í•œ ëª¨ë“  ë‘í˜„ ìºë¦­í„°ë“¤ì„ ë“±ê¸‰ë³„ë¡œ í™•ì¸í•˜ì„¸ìš”!</p>
    <div id="collection-list">
        <p id="empty-collection-message">ì•„ì§ íšë“í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <button id="clear-button" class="clear-btn">ì»¬ë ‰ì…˜ ì´ˆê¸°í™”</button>
</div>

<div id="enhance-screen" class="screen">
    <h2>âš”ï¸ ë‘í˜„ì˜ ê²€ ê°•í™”</h2>
    <p>ê²€ì„ ê°•í™”í•˜ì—¬ ë‘í˜„ì˜ í˜ì„ ê°œë°©í•˜ì„¸ìš”!</p>

    <div id="sword-display">
        <p>í˜„ì¬ ê°•í™”: <strong style="font-size: 1.2em;"><span id="current-sword-level">0</span>ê°•</strong></p>
        <h3 id="current-sword-name">ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)</h3>
    </div>

    <div id="enhance-controls">
        <div id="enhance-result">ê°•í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
        
        <div id="next-level-info" style="margin-top: 15px;">
            <p>ë‹¤ìŒ ë‹¨ê³„: <strong id="next-sword-level">1ê°•</strong></p>
            <p>ì„±ê³µ í™•ë¥ : <span id="next-success-rate">90</span>%</p>
            <p style="color: red;">íŒŒê´´ í™•ë¥ : <span id="next-destroy-rate">0</span>%</p>
        </div>

        <div class="protection-toggle">
            <input type="checkbox" id="protection-checkbox" style="vertical-align: middle;">
            <label for="protection-checkbox">íŒŒê´´ ë°©ì§€ (500 ì½”ì¸ ì¶”ê°€ ì†Œëª¨)</label>
        </div>

        <button id="enhance-button" class="btn-primary" style="margin-top: 15px; background-color: #4CAF50;">
            ê°•í™” ì‹œë„ (500 ì½”ì¸)
        </button>
    </div>
</div>

<div id="settings-screen" class="screen">
    <h2>âš™ï¸ ì•± ì„¤ì •</h2>
    
    <div class="settings-group">
        <h3>ğŸ“Š ë°ì´í„° ë°±ì—…</h3>
        <p>í˜„ì¬ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë°±ì—…í•©ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ë¥¼ ì•ˆì „í•œ ê³³ì— ë³´ê´€í•˜ì„¸ìš”.</p>
        <button id="backup-button" class="btn-setting">1. ë°±ì—… ë°ì´í„° ìƒì„±</button>
        <button id="copy-backup-button" class="btn-setting">2. í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
        <textarea id="backup-data-display" class="backup-restore" readonly placeholder="ë°±ì—… ë°ì´í„°ë¥¼ ìƒì„±í•˜ë©´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
    </div>

    <div class="settings-group">
        <h3>ğŸ“¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h3>
        <p>ë°±ì—…í•´ë‘” í…ìŠ¤íŠ¸ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  'ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
        <textarea id="restore-data-input" class="backup-restore" placeholder="ì´ê³³ì— ë°±ì—… ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <button id="restore-button" class="btn-setting restore">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <p style="font-size: 0.9em; color: red; margin-top: 10px;">
            âš ï¸ **ì£¼ì˜:** í˜„ì¬ ëª¨ë“  ì§„í–‰ ìƒí™©ì´ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤!
        </D>
    </div>
    
    <p id="settings-status" style="color: green;"></p>
</div>

</div>
<nav class="floating-nav">
    <button id="nav-gacha" class="nav-button active" data-screen="gacha-screen">ê°€ì± </button>
    <button id="nav-coin" class="nav-button" data-screen="coin-screen">ì½”ì¸ëª¨ìœ¼ê¸°</button>
    <button id="nav-collection" class="nav-button" data-screen="collection-screen">ì»¬ë ‰ì…˜</button>
    <button id="nav-enhance" class="nav-button" data-screen="enhance-screen">ê²€ê°•í™”</button>
    <button id="nav-settings" class="nav-button" data-screen="settings-screen">ì„¤ì •</button>
</nav>
<script>
    // ========================================================
    // I. ë°ì´í„° ë° ìƒìˆ˜ ì •ì˜
    // ========================================================
    const GACHA_COST = 250; 
    const SHEEP_BET_COST = 50;
    const USER_STATE_KEY = 'doukkiUserState';
    // [ì‚­ì œ] const GACHA_COOLDOWN = 1; 

    // âœ… ê°•í™” ì‹œìŠ¤í…œ ìƒìˆ˜
    const ENHANCE_COST = 500;
    const PROTECTION_COST = 500;

    // ë“±ê¸‰ ë° ìºë¦­í„° ì •ì˜ (ìƒˆë¡œìš´ ëª©ë¡ ë° í™•ë¥  ì ìš©)
    const RARITY_ORDER = ["M", "LR", "UR", "SSR", "SR", "R", "A", "B", "C", "D", "N"];
        
    // [ìˆ˜ì •] ìºë¦­í„° ì •ì˜: probabilityëŠ” ì´ì œ ì´ ë“±ê¸‰ ë‚´ì—ì„œì˜ *ê°€ì¤‘ì¹˜*ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    // (í˜„ì¬ëŠ” ëª¨ë“  ìºë¦­í„°ê°€ ë™ì¼ ê°€ì¤‘ì¹˜ë¥¼ ê°€ì§€ì§€ë§Œ, í–¥í›„ í™•ì¥ ê°€ëŠ¥)
    const characters = [
        // M (Myth)
        { name: "ë‘í˜„, ë¯¼ì´ˆì˜ ì‹ . ë‚¨ì •ë„¤ ì—†ëŠ” ì„¸ê³„ì˜ ì°½ì¡°ì.", rarity: "M", probability: 1, colorClass: "rank-M" },

        // LR (Legendary Rare)
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼, ì™•ê´€ì´ ë°˜ì§ì´ë‹ˆê¹Œ ì‹ ì„±í™”ëœ ë‘í˜„", rarity: "LR", probability: 1, colorClass: "rank-LR" },
        { name: "ë¯¼ì´ˆë¹› ì²œì‚¬ë¡œ ìŠ¹ì²œí•œ ë‘í˜„", rarity: "LR", probability: 1, colorClass: "rank-LR" },

        // UR (Ultra Rare)
        { name: "ë²Œë ˆì™€ ë¯¼ì´ˆë¡œ ì„¸ìƒì„ êµ¬í•œ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ì™¸ëŒ€ì—ì„œ ì‹ ê²©í™”ëœ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ë¯¼íŠ¸ë¹› ë‚ ê°œ ë‹¨ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ë©ì¹œê°œì™€ ì™•ê´€ ë‚˜ëˆ ì“°ëŠ” ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
            
        // SSR (Super Super Rare)
        { name: "ë²Œë ˆì™•êµ­ ê±´êµ­ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë¯¼ì´ˆìœ ë‹ˆë²„ìŠ¤ì˜ ì—¬ì™•", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë”ë¹™ì‡¼ì¸  1ì²œë§Œë·° ì‹ í™” ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ì´ê±´ ë‚˜ì˜ ì˜ˆìˆ ì´ë‹¤ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë©ì¹œê°œì™€ ë“€ì—£ì†¡ ë°œë§¤ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ëŒ€êµ¬ ìƒê³µì— ì™•ê´€ ë– ìˆëŠ” ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },

        // SR (Super Rare)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ë¯¼íŠ¸ë¹› ì˜¤ë¼ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë²Œë ˆë°´ë“œ ë³´ì»¬ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ì™¸ëŒ€ ì „ì„¤ì˜ ë¯¼ì´ˆì—¬ì‹  ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë©ì¹œê°œì™€ ì „í™” ì—°ê²° ì„±ê³µ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ë¼ ë²½í™” ì£¼ì¸ê³µ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë”ë¹™ì‡¼ì¸ ë¡œ ë°©ì†¡ ì¶œì—° ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë‚¨ì •ë„¤ê°€ ì‚¬ë¼ì§„ ì„¸ìƒ ê¿ˆê¾¸ëŠ” ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë¯¼ì´ˆ ì„±ì§€ìˆœë¡€ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
            
        // R (Rare)
        { name: "ë”ë¹™ì‡¼ì¸  100ë§Œë·° ë‹¬ì„± ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ì™¸ëŒ€ ì „ê´‘íŒ ë¯¼ì´ˆ ê´‘ê³  ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë²Œë ˆ ëŒ„ìŠ¤ ì±Œë¦°ì§€ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë©ì¹œê°œ ìƒë°©ì¤‘ ì±„íŒ… ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë‚¨ì •ë„¤ ê·¼ì²˜ ê¸ˆì§€ ë²•ì•ˆ ì œì•ˆ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ëŒ€êµ¬ ë¯¼ì´ˆ í˜ìŠ¤í‹°ë²Œ MC ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë²Œë ˆë“¤ì´ ë§Œë“  ì™•ê´€ ì“°ëŠ” ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë¯¼ì´ˆ or die ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë”ë¹™ ì¤‘ ì›ƒìŒ í„°ì§„ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },

        // A (Amazing)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ì™•ê´€ ë„ìš´ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë‚˜ëŠ” ë²Œë ˆì˜ ì—¬ì™•ì´ë‹¤ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ì™¸ëŒ€ ë¯¼ì´ˆì˜ ì „ì„¤ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë©ì¹œê°œì™€ í†µí™” ì„±ê³µ ì§ì „ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë”ë¹™ì‡¼ì¸  10ë§Œ ì¢‹ì•„ìš” ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë¯¼ì´ˆ í­í¬ ì•„ë˜ì—ì„œ ëª…ìƒí•˜ëŠ” ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë²Œë ˆ ì½”ìŠ¤í”„ë ˆ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë‚¨ì •ë„¤ ëª©ì†Œë¦¬ ê°ì§€ ì°¨ë‹¨ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ëŒ€êµ¬ ê±°ë¦¬ ë¯¼ì´ˆ ë²„ìŠ¤ê´‘ê³  ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ì™•ê´€ë³´ë‹¤ ì†Œì¤‘í•œ ê±´ ìì¡´ì‹¬ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
            
        // B (Better)
        { name: "ë¯¼ì´ˆêµ ì°½ì‹œì ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ìƒì¼ì— ì˜ìƒ í¸ì§€ ë³´ë‚´ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ê°€ ì„ ìƒë‹˜â™¡ í•˜ì í­ì£¼ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë¯¼íŠ¸ë¹› ì¡°ëª… ì•„ë˜ ì¶¤ì¶”ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë”ë¹™ì‡¼ì¸  í¸ì§‘ ì¤‘ ê³¼ëª°ì… ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ëŒ€êµ¬ì—­ ë¯¼ì´ˆ í™ë³´ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ê³ ê°œ ìˆ™ì´ë©´ ì™•ê´€ ë–¨ì–´ì ¸ìš” ëª…ì–¸ ìŠ¤í”¼ì»¤ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ì™¸ëŒ€ ì¶•ì œì—ì„œ ë²Œë ˆ í¼ë ˆì´ë“œ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ì´ë¦„ ìƒˆê¸´ ëª©ê±¸ì´ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë¯¼ì´ˆ ìŒë£Œ í™ë³´ëŒ€ì‚¬ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ ì°¨ë‹¨ ì™„ë£Œ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë²Œë ˆì™€ ë¸Œì´ë¡œê·¸ ì°ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },

        // C (Common+)
        { name: "ë²Œë ˆ ì¹œêµ¬ ìƒì¼ íŒŒí‹° ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë¯¼ì´ˆ ì•„ì´ìŠ¤í¬ë¦¼ í¬ì¥ ì•Œë°” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë”ë¹™ì‡¼ì¸  ì¸ë„¤ì¼ ê³ ë¥´ëŠ” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ì™¸ëŒ€ ë¯¼ì´ˆ ë™ì•„ë¦¬ íšŒì¥ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ê³ ê°œë¥¼ ìˆ™ì´ì§€ ë§ë¼ í˜„ìˆ˜ë§‰ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ëŒ€êµ¬ ì¹´í˜ ë¯¼ì´ˆë¼ë–¼ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë‚¨ì •ë„¤ì—ê²Œ ë¯¼ì´ˆ í­íƒ„ íˆ¬ì²™ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ì™•ê´€ì— ë¯¼ì´ˆ ì¥ì‹ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë²Œë ˆì™€ ì‚°ì±… ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë©ì¹œê°œ êµ¿ì¦ˆ ëª¨ìœ¼ëŠ” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë”ë¹™ ëŒ€ë³¸ì— í—¤ìœ¼ì‘ ê¸ˆì§€ ì ì€ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë‘í˜„ is love ë…¸ë˜ ë¶€ë¥´ëŠ” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ì™¸ëŒ€ ìˆ˜ì—… ì¤‘ ë²Œë ˆ ìŠ¤ì¼€ì¹˜ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },

        // D (Decent)
        { name: "ëŒ€êµ¬ì—ì„œ ë©ì¹œê°œ êµ¿ì¦ˆ ì‚¬ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë²Œë ˆ ì´ëª¨í‹°ì½˜ ë§Œë“œëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë‚¨ì •ë„¤ í•„í„° ì•± ë§Œë“¤ë ¤ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ì™¸ëŒ€ ê°•ì˜ì‹¤ì—ì„œ ì¡¸ê³  ìˆëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë¯¼ì´ˆë¼ë–¼ ë§ˆì‹œë©° ì² í•™í•˜ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë²Œë ˆë‘ ë°¥ ë‚˜ëˆ ë¨¹ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ê³ ê°œ ìˆ™ì˜€ë”ë‹ˆ ì™•ê´€ ë•… ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë©ì¹œê°œ ì˜ìƒ ë°˜ë³µ ì‹œì²­ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë¯¼íŠ¸ìƒ‰ íŒŒì¹´ ì…ì€ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë‚˜ ë‘ë¼ì•¼! ì™¸ì¹˜ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë¯¼ì´ˆ ì¼€ì´í¬ ì‹¤íŒ¨í•œ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë”ë¹™ ë…¹ìŒ ì¤‘ ì¬ì±„ê¸° ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ì™¸ëŒ€ ì”ë””ë°­ ë²Œë ˆ íƒì‚¬ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë‚˜ëŠ” ë‚¨ì •ë„¤ê°€ ì‹«ë‹¤ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ì™•ê´€ì— ìŠ¤í‹°ì»¤ ë¶™ì¸ ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },

        // N (Normal)
        { name: "ëŒ€êµ¬ ì§€í•˜ì² ì—ì„œ ë¯¼ì´ˆ ë¨¹ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì™¸ëŒ€ ë§¤ì ì—ì„œ í¬ì¹´ë¦¬ ì‚¬ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë²Œë ˆí•œí…Œ ì˜¤ëŠ˜ ì–´ë• ì–´? ë¬»ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë‚¨ì •ë„¤ê°€ ì¸ì‚¬í•˜ì ë„ë§ê°€ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë”ë¹™ ì—°ìŠµí•˜ë‹¤ ì¹¨ íŠ„ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼â€¦ í˜¼ì£ë§ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì»¤í”¼ ë“¤ê³  ë²„ìŠ¤ ë†“ì¹œ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë¯¼íŠ¸ìƒ‰ ìŠ¬ë¦¬í¼ ì‹ ì€ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ ë°”ë¼ë³´ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë©ì¹œê°œ ë°©ì†¡ ê¸°ë‹¤ë¦¬ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë²Œë ˆì•¼ ë‚˜ ë°¥ ë¨¹ì—ˆì–´? ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì™¸ëŒ€ì—ì„œ ë²Œë ˆ í¬íš ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì™•ê´€ ë–¨ì–´ëœ¨ë¦¬ê³  ì£¼ìš´ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë‚¨ì •ë„¤ê°€ í—¤ìœ¼ì‘ í•˜ì ê¸°ê²í•˜ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë‘í˜„ëœë“œ ìƒìƒ ì¤‘ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë”ë¹™ ëŒ€ë³¸ ì°¢ì€ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë¯¼ì´ˆëŠ” ê³¼í•™ì´ë‹¤ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë²Œë ˆì—ê²Œ í•˜ì´íŒŒì´ë¸Œ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë¯¼ì´ˆ ìŠ¤í‹°ì»¤ ë¶™ì´ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë”ë¹™ ì—°ìŠµ ì¤‘ í•˜í’ˆí•˜ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
    ];
        
    // [ìˆ˜ì •] ê°€ì±  í™•ë¥  ì •ì˜ (ê¸°ì¡´ ê°€ì¤‘ì¹˜ ê¸°ë°˜)
    // N: 80, D: 60, C: 50, B: 40, A: 30, R: 20, SR: 10, SSR: 2, UR: 0.4, LR: 0.002, M: 0.0001
    // ì´í•©: 292.4021
    const BASE_GACHA_WEIGHTS = {
        M: 0.0001,
        LR: 0.002,
        UR: 0.4,
        SSR: 2,
        SR: 10,
        R: 20,
        A: 30,
        B: 40,
        C: 50,
        D: 60,
        N: 80
    };
    const TOTAL_BASE_WEIGHT = 292.4021; // ëª¨ë“  ê°€ì¤‘ì¹˜ì˜ í•©
    
    // [ì‹ ê·œ] ê°•í™” ë ˆë²¨ì— ë”°ë¥¸ ì¶”ê°€ í™•ë¥  (í¼ì„¼íŠ¸: 1% = 0.01)
    const ENHANCE_BONUS_RATES = {
        N: 0.02,   // 2%
        D: 0.03,   // 3%
        C: 0.04,   // 4%
        B: 0.05,   // 5%
        A: 0.06,   // 6%
        R: 0.07,   // 7%
        SR: 0.08,  // 8%
        SSR: 0.08, // 8%
        UR: 0.01,  // 1%
        LR: 0.0005, // 0.05%
        M: 0.0005  // 0.05%
    };
        
    let userState = {
        coins: 500,
        collection: [],
        swordLevel: 0 // âœ… ê²€ ê°•í™” ë ˆë²¨ ì¶”ê°€
    };
        
    // [ì‚­ì œ]
    // let isGachaOnCooldown = false;
    // let cooldownTimerId = null;

    // ì–‘í„¸ ë„ë°• ìƒìˆ˜
    const RAINBOW_COLORS = [
        { name: "ë¹¨ê°•", class: "color-red" },
        { name: "ì£¼í™©", class: "color-orange" },
        { name: "ë…¸ë‘", class: "color-yellow" },
        { name: "ì´ˆë¡", class: "color-green" },
        { name: "íŒŒë‘", class: "color-blue" },
        { name: "ë‚¨ìƒ‰", class: "color-indigo" },
        { name: "ë³´ë¼", class: "color-violet" }
    ];
    
    const SHEEP_REWARD_MAP = {
        2: 300, 3: 2000, 4: 10000, 5: 100000
    };

    // ì¿µì“°ì¿µì“° ê²Œì„ ìƒìˆ˜
    const KUNGSS_WORDS = ["ê¹€ë‘í˜„ì¿µìŠ¤", "ê¹€ë‘í˜„ê¸°ì¦ë‚˜ìš”", "ê¹€ë‘ë‹¤ë‹¤ì¿µ", "ê¹€ê¹€ë‘í˜„ê¹€ê¹€ë‘í˜„ë‘í˜„", "ë‚¨ì •ë„¤"];
    const KUNGSS_ROUNDS = 3;
    const KUNGSS_TIME_LIMIT = 5; 
    const KUNGSS_REWARD = 2000;
    const KUNGSS_SEQUENCE_LENGTH = 3; 

    // ì¿µì“° ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let kungssCurrentRound = 0;
    let kungssTimerId = null;
    let kungssTargetSequence = []; 
    let kungssUserInput = [];

    // âœ… ê°•í™” í™•ë¥ í‘œ (ë§ˆì¼ìŠ¤í†¤)
    // íŒŒê´´ í™•ë¥ ì„ ì„ì˜ë¡œ ì„¤ì • (ì„±ê³µë¥ ì´ ë‚®ì•„ì§ˆìˆ˜ë¡ íŒŒê´´ìœ¨ ì¦ê°€)
    const ENHANCEMENT_MILESTONES = [
        { level: 1, name: "ê¹¨ì–´ë‚˜ëŠ” ë‘í˜„ì˜ ê²€", success: 90, destroy: 0 },
        { level: 5, name: "ë²Œë ˆì˜ ì¶•ë³µì„ ë°›ì€ ê²€", success: 80, destroy: 2 },
        { level: 10, name: "ë‚¨ì •ë„¤ ì°¨ë‹¨ì˜ ê²€", success: 70, destroy: 5 },
        { level: 15, name: "ë©ì¹œê°œì˜ ì¸ë„", success: 60, destroy: 7 },
        // âœ… 20ê°• ~ 70ê°• í™•ë¥  ìˆ˜ì •
        { level: 20, name: "ê³ ê°œë¥¼ ìˆ™ì´ì§€ ì•ŠëŠ” ê²€", success: 30, destroy: 10 },
        { level: 25, name: "ë¯¼ì´ˆì˜ ê¸°ìš´ì´ íë¥´ëŠ” ê²€", success: 25, destroy: 12 },
        { level: 30, name: "ì™¸ëŒ€ì˜ ì „ì„¤", success: 20, destroy: 15 },
        { level: 35, name: "ëŒ€êµ¬ì˜ ë¯¼ì´ˆ ìˆ˜í˜¸ì", success: 15, destroy: 18 },
        { level: 40, name: "ë”ë¹™ì˜ ì—¬ì‹  ë‘í˜„ì˜ ê²€", success: 13, destroy: 20 },
        { level: 45, name: "ë‚¨ì •ë„¤ ë©¸ì ˆì˜ ì„œì•½", success: 10, destroy: 25 },
        { level: 50, name: "ë²Œë ˆì˜ êµ°ì„¸ê°€ ê¹ƒë“  ê²€", success: 9, destroy: 30 },
        { level: 55, name: "ë¯¼ì´ˆì‹ ì˜ ì‹¬íŒ", success: 9, destroy: 35 },
        { level: 60, name: "ë‘í˜„ì˜ ì™•ê´€ ê°ì„±", success: 9, destroy: 40 },
        { level: 70, name: "ë¯¼ì´ˆì°¨ì›ì˜ ë¬¸ì§€ê¸°", success: 6, destroy: 45 },
        // âœ…
        { level: 80, name: "ë¯¼ì´ˆì—¬ì‹ ì˜ í™”ì‹ ", success: 5, destroy: 50 },
        { level: 90, name: "ê³ ê°œ ìˆ™ì´ì§€ ì•ŠëŠ” ì„¸ê³„", success: 2, destroy: 60 },
        { level: 95, name: "ë²Œë ˆì™€ í•˜ë‚˜ê°€ ëœ ë‘í˜„", success: 0.5, destroy: 70 },
        { level: 99, name: "ë¯¼ì´ˆì˜ ì‹ ì„±ê²€ â€˜ë‘ë¼ ë¸”ë ˆì´ë“œâ€™", success: 0.1, destroy: 80 },
        { level: 100, name: "ğŸŒ¿ì‹ í™”: â€œë‘í˜„, ì™•ê´€ì„ ìƒì§€ ì•Šì€ ìâ€", success: 0.01, destroy: 90 }
    ];

    // âœ… 1~100ê°• ì „ì²´ ë°ì´í„° ìƒì„±
    const ENHANCEMENT_STATS = {};
    let currentStats = { success: 100, destroy: 0 };
    let currentName = "ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)";

    for (let i = 1; i <= 100; i++) {
        const milestone = ENHANCEMENT_MILESTONES.find(m => m.level === i);
        if (milestone) {
            currentStats = { success: milestone.success, destroy: milestone.destroy };
            currentName = milestone.name;
        }
        ENHANCEMENT_STATS[i] = {
            level: i,
            name: currentName,
            success: currentStats.success,
            destroy: currentStats.destroy
        };
    }

    // ========================================================
    // II. DOM ìš”ì†Œ ì ‘ê·¼
    // ========================================================
    const gachaButton = document.getElementById('gacha-button');
    // [ì‚­ì œ] const gachaCooldownDisplay = document.getElementById('gacha-cooldown-display');
    const resultDisplay = document.getElementById('result-display');
    const collectionList = document.getElementById('collection-list');
    const coinCountElement = document.getElementById('coin-count');
    const screens = document.querySelectorAll('.screen');
    const navButtons = document.querySelectorAll('.nav-button');
    const emptyCollectionMessage = document.getElementById('empty-collection-message');
    
    // [ì‹ ê·œ] ê°€ì±  ì• ë‹ˆë©”ì´ì…˜ DOM (ì°¸ì¡°ëŠ” ë‚¨ê²¨ë‘ )
    const gachaAnimationContainer = document.getElementById('gacha-animation-container');
    const gachaReel = document.getElementById('gacha-reel');
        
    // ì–‘í„¸ ë„ë°• DOM
    const sheepPickerArea = document.getElementById('sheep-picker-area');
    const colorPalette = document.getElementById('color-palette');
    const startSheepBetBtn = document.getElementById('start-sheep-bet-btn');
    const sheepResult = document.getElementById('sheep-result');
    const selectedSheepColorsDisplay = document.getElementById('selected-sheep-colors');

    // ì¿µì“°ì¿µì“° DOM
    const startKungssGameBtn = document.getElementById('start-kungss-game-btn');
    const kungssTarget = document.getElementById('kungss-target');
    const kungssButtons = document.getElementById('kungss-buttons');
    const kungssTimer = document.getElementById('kungss-timer');
    const kungssStatus = document.getElementById('kungss-status');
        
    // âœ… ê°•í™” DOM
    const enhanceButton = document.getElementById('enhance-button');
    const protectionCheckbox = document.getElementById('protection-checkbox');
    const currentSwordLevel = document.getElementById('current-sword-level');
    const currentSwordName = document.getElementById('current-sword-name');
    const enhanceResult = document.getElementById('enhance-result');
    const nextSwordLevel = document.getElementById('next-sword-level');
    const nextSuccessRate = document.getElementById('next-success-rate');
    const nextDestroyRate = document.getElementById('next-destroy-rate');

    // [ì¶”ê°€] ì„¤ì • DOM
    const backupButton = document.getElementById('backup-button');
    const copyBackupButton = document.getElementById('copy-backup-button');
    const backupDataDisplay = document.getElementById('backup-data-display');
    const restoreDataInput = document.getElementById('restore-data-input');
    const restoreButton = document.getElementById('restore-button');
    const settingsStatus = document.getElementById('settings-status');

    // ========================================================
    // III. ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜
    // ========================================================

    function loadUserState() {
        const data = localStorage.getItem(USER_STATE_KEY);
        if (data) {
            const loadedState = JSON.parse(data);
            // swordLevelì´ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™”
            if (loadedState.swordLevel === undefined) {
                loadedState.swordLevel = 0;
            }
            userState = { ...userState, ...loadedState };
        }
    }

    function saveUserState() {
        localStorage.setItem(USER_STATE_KEY, JSON.stringify(userState));
    }

    function updateCoinDisplay() {
        coinCountElement.textContent = userState.coins;
    }

    function addCoin(amount) {
        userState.coins += amount;
        saveUserState();
        updateCoinDisplay();
    }

    function subtractCoin(amount) {
        if (userState.coins < amount) {
            return false;
        }
        userState.coins -= amount;
        saveUserState();
        updateCoinDisplay();
        return true;
    }

    // ========================================================
    // IV. ê°€ì± /ì»¬ë ‰ì…˜ ë¡œì§
    // ========================================================

    // [ìˆ˜ì •] conductGacha: ê°•í™” ë ˆë²¨ì— ë”°ë¥¸ í™•ë¥  ë³€ë™ ë¡œì§
    function conductGacha() {
        // 1. í˜„ì¬ ê°•í™” ë ˆë²¨ë¡œ ë§ˆì¼ìŠ¤í†¤ ê³„ì‚°
        const milestones = Math.floor(userState.swordLevel / 20);
        
        let adjustedProbs = {};
        let totalAdjustedProb = 0;

        // 2. ëª¨ë“  ë“±ê¸‰ì— ëŒ€í•´ ìƒˆë¡œìš´ í™•ë¥  ê³„ì‚°
        RARITY_ORDER.forEach(rarity => {
            // 2-1. ê¸°ë³¸ í™•ë¥  (ê°€ì¤‘ì¹˜ / ì´ ê°€ì¤‘ì¹˜)
            const baseProb = (BASE_GACHA_WEIGHTS[rarity] || 0) / TOTAL_BASE_WEIGHT;
            
            // 2-2. ë³´ë„ˆìŠ¤ í™•ë¥  (ë“±ê¸‰ë³„ ë³´ë„ˆìŠ¤ * ë§ˆì¼ìŠ¤í†¤)
            const bonusProb = (ENHANCE_BONUS_RATES[rarity] || 0) * milestones;
            
            // 2-3. ìƒˆë¡œìš´ í™•ë¥  = ê¸°ë³¸ í™•ë¥  + ë³´ë„ˆìŠ¤ í™•ë¥ 
            const newProb = baseProb + bonusProb;
            
            adjustedProbs[rarity] = newProb;
            totalAdjustedProb += newProb; // ëª¨ë“  ìƒˆ í™•ë¥ ì˜ ì´í•© (1ì´ ë„˜ì„ ìˆ˜ ìˆìŒ)
        });

        // 3. í™•ë¥  ì •ê·œí™” (ëª¨ë“  í™•ë¥ ì˜ í•©ì´ 1(100%)ì´ ë˜ë„ë¡ ì¡°ì •)
        const random = Math.random(); // 0 ~ 1 ì‚¬ì´ì˜ ê°’
        let cumulativeProb = 0;
        let selectedRarity = "N"; // ê¸°ë³¸ê°’
        
        for (const rarity of RARITY_ORDER) {
            // 3-1. ì •ê·œí™”ëœ í™•ë¥  (í˜„ì¬ ë“±ê¸‰ í™•ë¥  / ìƒˆ í™•ë¥  ì´í•©)
            const normalizedProb = adjustedProbs[rarity] / totalAdjustedProb;
            cumulativeProb += normalizedProb;
            
            if (random < cumulativeProb) {
                selectedRarity = rarity;
                break;
            }
        }

        // 4. ì„ íƒëœ ë“±ê¸‰(selectedRarity) ë‚´ì—ì„œ ìºë¦­í„° ë¬´ì‘ìœ„ ì¶”ì²¨
        const possibleChars = characters.filter(c => c.rarity === selectedRarity);
        
        // ë“±ê¸‰ ë‚´ ìºë¦­í„°ê°€ ì—†ëŠ” ê²½ìš° Në“±ê¸‰ì—ì„œ ì¶”ì²¨ (ì˜¤ë¥˜ ë°©ì§€)
        if (possibleChars.length === 0) {
            const fallbackChars = characters.filter(c => c.rarity === "N");
            const randomIndex = Math.floor(Math.random() * fallbackChars.length);
            return fallbackChars[randomIndex];
        }

        // ë“±ê¸‰ ë‚´ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¶”ì²¨ (í˜„ì¬ëŠ” ëª¨ë‘ 1ì´ë¼ ë™ì¼ í™•ë¥ )
        const totalWeightInRarity = possibleChars.reduce((sum, char) => sum + char.probability, 0);
        const randomWeight = Math.random() * totalWeightInRarity;
        let cumulativeWeight = 0;
        
        for (const char of possibleChars) {
            cumulativeWeight += char.probability;
            if (randomWeight < cumulativeWeight) {
                return char;
            }
        }
        
        return possibleChars[0]; // ë§Œì•½ì˜ ê²½ìš° ë§ˆì§€ë§‰ ìºë¦­í„° ë°˜í™˜
    }

    // [ì‚­ì œ] startGachaCooldown í•¨ìˆ˜
    
    // [ì‹ ê·œ] ê°€ì±  ë¦´(ì• ë‹ˆë©”ì´ì…˜) ìƒì„± (í•¨ìˆ˜ëŠ” ë‚¨ì•„ìˆì§€ë§Œ handleGachaì—ì„œ í˜¸ì¶œ ì•ˆ í•¨)
    function setupGachaReel() {
        gachaReel.innerHTML = '';
        gachaReel.classList.remove('spinning');
        
        // 50ê°œì˜ ëœë¤ ì•„ì´í…œ ìƒì„±
        for (let i = 0; i < 50; i++) {
            const item = document.createElement('span');
            item.classList.add('gacha-item');
            
            // CSS ìŠ¤íƒ€ì¼ ì ìš©ì„ ìœ„í•´ ëœë¤ ë“±ê¸‰ ë¶€ì—¬
            const randomRarityIndex = Math.floor(Math.random() * RARITY_ORDER.length);
            const randomRarity = RARITY_ORDER[randomRarityIndex];
            item.classList.add(`rank-${randomRarity}`);
            item.textContent = `????`;
            
            gachaReel.appendChild(item);
        }
    }

    // [ìˆ˜ì •] handleGacha: ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ì œê±°, ì¦‰ì‹œ ë½‘ê¸°
    function handleGacha() {
        if (!subtractCoin(GACHA_COST)) {
            resultDisplay.innerHTML = `<p style="color: red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${GACHA_COST})</p>`;
            return;
        }
        
        // 1. ë²„íŠ¼ ë¹„í™œì„±í™” (ë½‘ê¸° ì²˜ë¦¬ ì¤‘)
        gachaButton.disabled = true;
        
        // 2. [ì‚­ì œ] ì• ë‹ˆë©”ì´ì…˜ ê´€ë ¨ ì½”ë“œ
        // resultDisplay.style.display = 'none';
        // setupGachaReel(); // ë¦´ ì´ˆê¸°í™”
        // gachaAnimationContainer.style.display = 'block';
        // void gachaReel.offsetWidth; 
        // gachaReel.classList.add('spinning');
        
        // [ì¶”ê°€] ê²°ê³¼ì°½ì´ í•­ìƒ ë³´ì´ë„ë¡ ë³´ì¥
        resultDisplay.style.display = 'block';

        // 3. [ì‚­ì œ] setTimeout ì œê±°
        
        // 4. [í•µì‹¬] ì‹¤ì œ ë½‘ê¸° ë¡œì§ì€ ë°”ë¡œ ì‹¤í–‰
        const pulledCharacter = conductGacha();

        // 5. ê²°ê³¼ ë°”ë¡œ í‘œì‹œ
        resultDisplay.innerHTML = `
            ğŸ‰ **ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸ‰<br>
            <span class="character-tag ${pulledCharacter.colorClass}">${pulledCharacter.rarity}</span> 
            <strong>${pulledCharacter.name}</strong>ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!
        `;
        
        // 6. ì»¬ë ‰ì…˜ì— ì €ì¥
        userState.collection.push(pulledCharacter.name);
        saveUserState();
        
        // 7. [ì¶”ê°€] ë²„íŠ¼ ì¦‰ì‹œ ë‹¤ì‹œ í™œì„±í™”
        gachaButton.disabled = false;
    }

    function displayCollection() { 
        const collection = userState.collection;
        collectionList.innerHTML = ''; 

        if (collection.length === 0) {
            emptyCollectionMessage.style.display = 'block';
            return;
        } else {
            emptyCollectionMessage.style.display = 'none';
        }

        const countsByRarity = {};
        RARITY_ORDER.forEach(rarity => { countsByRarity[rarity] = []; });
            
        collection.forEach(name => {
            const charInfo = characters.find(c => c.name === name);
            if (charInfo) {
                const existing = countsByRarity[charInfo.rarity].find(item => item.name === name);
                if (existing) { existing.count++; } 
                else { countsByRarity[charInfo.rarity].push({ name: name, count: 1, colorClass: charInfo.colorClass }); }
            }
        });

        RARITY_ORDER.forEach(rarity => {
            const charList = countsByRarity[rarity];
            if (charList && charList.length > 0) {
                const sectionDiv = document.createElement('div');
                sectionDiv.classList.add('collection-section');
                const title = document.createElement('h4');
                title.textContent = `${rarity} ë“±ê¸‰ (ì´ ${charList.reduce((sum, item) => sum + item.count, 0)}ê°œ)`;
                sectionDiv.appendChild(title);
                const container = document.createElement('div');
                container.classList.add('collection-container');

                charList.forEach(item => {
                    const tag = document.createElement('span');
                    tag.classList.add('character-tag', item.colorClass);
                    tag.textContent = `${item.name} (x${item.count})`;
                    container.appendChild(tag);
                });

                sectionDiv.appendChild(container);
                collectionList.appendChild(sectionDiv);
            }
        });
    }

    function clearCollection() { 
        if (confirm("ì •ë§ë¡œ ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ëœ ëª¨ë“  ìºë¦­í„°ì™€ ê°•í™” ë ˆë²¨ì´ ì‚­ì œë©ë‹ˆë‹¤.")) {
            userState.collection = [];
            userState.coins = 500;
            userState.swordLevel = 0; // âœ… ê°•í™” ë ˆë²¨ ì´ˆê¸°í™”
            saveUserState();
            updateCoinDisplay();
            displayCollection();
            updateEnhancementUI(); // âœ… ê°•í™” UIë„ ì—…ë°ì´íŠ¸
            document.getElementById('result-display').innerHTML = '<p>ì»¬ë ‰ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë½‘ê¸°ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.</p>';
        }
    }
        
    // ========================================================
    // V. ì–‘í„¸ ë„ë°• ë¡œì§
    // ========================================================

    let userSheepPicks = new Array(5).fill(null); 
    let selectedColor = RAINBOW_COLORS[0].name; 

    function initSheepGame() {
        // 1. ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„±
        colorPalette.innerHTML = '';
        RAINBOW_COLORS.forEach(color => {
            const option = document.createElement('div');
            option.classList.add('color-option', color.class);
            option.dataset.color = color.name;
            option.addEventListener('click', () => { selectColorOption(color.name, option); });
            colorPalette.appendChild(option);
        });
        selectColorOption(RAINBOW_COLORS[0].name, colorPalette.firstChild);

        // 2. ì–‘í„¸ í”½ì»¤ ìƒì„±
        sheepPickerArea.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const sheep = document.createElement('div');
            sheep.classList.add('sheep-wool');
            sheep.dataset.index = i;
            sheep.addEventListener('click', () => { selectSheepColor(i, sheep); });
            sheepPickerArea.appendChild(sheep);
        }
            
        // 3. ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        userSheepPicks.fill(null);
        updateSheepDisplay();
        sheepResult.textContent = 'ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì–‘í„¸ì— ì„ íƒí•´ ì£¼ì„¸ìš”.';
    }
        
    function selectColorOption(colorName, element) {
        document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        selectedColor = colorName;
    }

    function selectSheepColor(index, sheepElement) {
        userSheepPicks[index] = selectedColor;
            
        sheepElement.className = 'sheep-wool selected'; 
        const colorData = RAINBOW_COLORS.find(c => c.name === selectedColor);
        if (colorData) {
            sheepElement.classList.add(colorData.class);
        }
            
        updateSheepDisplay();
    }

    function updateSheepDisplay() {
        const displayNames = userSheepPicks.map(name => name ? name : '??');
        selectedSheepColorsDisplay.textContent = displayNames.join(', ');
            
        document.querySelectorAll('.sheep-wool').forEach((sheep, index) => {
            const selected = userSheepPicks[index];
            sheep.className = 'sheep-wool';
            if (selected) {
                sheep.classList.add('selected');
                const colorData = RAINBOW_COLORS.find(c => c.name === selected);
                if (colorData) {
                    sheep.classList.add(colorData.class);
                }
            }
        });
    }

    function startSheepBet() {
        if (!subtractCoin(SHEEP_BET_COST)) {
            sheepResult.innerHTML = `<span style="color:red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${SHEEP_BET_COST})</span>`;
            return;
        }

        if (userSheepPicks.includes(null)) {
            addCoin(SHEEP_BET_COST); 
            sheepResult.innerHTML = '<span style="color:red;">âŒ 5ê°œì˜ ì–‘í„¸ ìƒ‰ê¹”ì„ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.</span>';
            return;
        }

        const randomResult = [];
        for (let i = 0; i < 5; i++) {
            const randomIndex = Math.floor(Math.random() * RAINBOW_COLORS.length);
            randomResult.push(RAINBOW_COLORS[randomIndex].name);
        }

        let matchedCount = 0;
        for (let i = 0; i < 5; i++) {
            if (userSheepPicks[i] === randomResult[i]) {
                matchedCount++;
            }
        }

        sheepResult.innerHTML = `
            <p>ë‹¹ì‹ ì˜ ì„ íƒ: ${userSheepPicks.join(', ')}</p>
            <p>ëœë¤ ê²°ê³¼: ${randomResult.join(', ')}</p>
            <p style="font-size: 1.3em; margin: 10px 0;">âœ… **${matchedCount}ê°œ** ì¼ì¹˜!</p>
        `;

        let reward = SHEEP_REWARD_MAP[matchedCount] || 0; 
        let resultText = '';

        if (reward > 0) {
            addCoin(reward);
            resultText = `<span style="color: green; font-weight: bold;">ğŸ‰ ìŠ¹ë¦¬! ${reward} ì½”ì¸ íšë“! (í˜„ì¬ ${userState.coins})</span>`;
        } else {
            resultText = `<span style="color: red; font-weight: bold;">ğŸ˜­ íŒ¨ë°°! ${SHEEP_BET_COST} ì½”ì¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ${userState.coins})</span>`;
        }

        sheepResult.innerHTML += resultText;
            
        document.querySelectorAll('.sheep-wool').forEach((sheep, index) => {
            const resultColorName = randomResult[index];
            const resultColorData = RAINBOW_COLORS.find(c => c.name === resultColorName);
                
            sheep.className = 'sheep-wool selected'; 
            sheep.classList.add(resultColorData.class);
                
            if (userSheepPicks[index] === randomResult[index]) {
                sheep.style.border = '4px solid gold';
            } else {
                sheep.style.border = '4px solid red';
            }
        });
        setTimeout(() => {
            document.querySelectorAll('.sheep-wool').forEach(s => s.style.border = '4px solid #333');
        }, 3000); 
    }

    // ========================================================
    // VI. ì¿µì“°ì¿µì“° ê²Œì„ ë¡œì§
    // ========================================================

    function initKungssGame() {
        resetKungssGame();
    }

    function resetKungssGame() {
        kungssCurrentRound = 0;
        kungssTargetSequence = [];
        kungssUserInput = [];
        kungssStatus.textContent = `ì¤€ë¹„ (ì´ ${KUNGSS_ROUNDS} ë¼ìš´ë“œ, ë‹¨ì–´ 3ê°œ ìˆœì„œ ì…ë ¥)`;
        kungssTimer.textContent = `ì‹œê°„: ${KUNGSS_TIME_LIMIT}ì´ˆ`; 
        kungssTarget.textContent = 'ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...';
        startKungssGameBtn.disabled = false;
        kungssButtons.innerHTML = ''; 
    }

    function startKungssGame() {
        startKungssGameBtn.disabled = true;
        kungssCurrentRound = 0;
        runKungssRound();
    }

    function runKungssRound() {
        kungssCurrentRound++;
        if (kungssCurrentRound > KUNGSS_ROUNDS) {
            // ê²Œì„ ì„±ê³µ
            clearTimeout(kungssTimerId);
            addCoin(KUNGSS_REWARD);
            kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">ğŸ‰ 3ë¼ìš´ë“œ ì„±ê³µ! ${KUNGSS_REWARD} ì½”ì¸ íšë“!</span>`;
            kungssTarget.textContent = 'ê²Œì„ ìŠ¹ë¦¬!';
            kungssButtons.innerHTML = '';
            setTimeout(resetKungssGame, 3000);
            return;
        }

        // ë¼ìš´ë“œ ì¤€ë¹„
        kungssUserInput = []; 
        kungssStatus.textContent = `ë¼ìš´ë“œ ${kungssCurrentRound} / ${KUNGSS_ROUNDS} (ì…ë ¥ 0/${KUNGSS_SEQUENCE_LENGTH})`;

        // 1. ëœë¤ ë‹¨ì–´ ì‹œí€€ìŠ¤ 3ê°œ ì„ íƒ (ì •ë‹µ)
        let sequence = [];
        for (let i = 0; i < KUNGSS_SEQUENCE_LENGTH; i++) {
            const randomIndex = Math.floor(Math.random() * KUNGSS_WORDS.length);
            sequence.push(KUNGSS_WORDS[randomIndex]);
        }
        kungssTargetSequence = sequence;
        kungssTarget.textContent = `â–¶ï¸ ${kungssTargetSequence.join(' | ')} â—€ï¸`; 

        // 2. ë²„íŠ¼ì— í‘œì‹œë  ë‹¨ì–´ 4ê°œ ì„ íƒ (ì •ë‹µ 3ê°œ + ì˜¤ë‹µ 1ê°œ)
        let buttonWords = [...new Set(kungssTargetSequence)]; 

        // ì˜¤ë‹µ ë‹¨ì–´ 1ê°œ ì¶”ê°€
        let availableMissWords = KUNGSS_WORDS.filter(word => !kungssTargetSequence.includes(word));
        if (availableMissWords.length > 0 && buttonWords.length < 4) {
            const randomMissIndex = Math.floor(Math.random() * availableMissWords.length);
            buttonWords.push(availableMissWords[randomMissIndex]);
        }
            
        while(buttonWords.length < 4 && KUNGSS_WORDS.length >= 4) {
            const randomIndex = Math.floor(Math.random() * KUNGSS_WORDS.length);
            const wordToAdd = KUNGSS_WORDS[randomIndex];
            if (!buttonWords.includes(wordToAdd)) {
                 buttonWords.push(wordToAdd);
            }
        }

        buttonWords.sort(() => Math.random() - 0.5);

        kungssButtons.innerHTML = '';
        buttonWords.forEach(word => {
            const btn = document.createElement('button');
            btn.classList.add('kungss-btn');
            btn.textContent = word;
            btn.dataset.word = word;
            btn.disabled = false; 
            btn.addEventListener('click', handleKungssButtonClick);
            kungssButtons.appendChild(btn);
        });

        let timeLeft = KUNGSS_TIME_LIMIT;
        kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;

        clearTimeout(kungssTimerId);
        kungssTimerId = setInterval(() => {
            timeLeft--;
            kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;
            if (timeLeft <= 0) {
                clearInterval(kungssTimerId);
                failKungssGame(`ì‹œê°„ ì´ˆê³¼! ì •ë‹µì€ "${kungssTargetSequence.join(' | ')}"ì˜€ìŠµë‹ˆë‹¤.`);
            }
        }, 1000);
    }

    function handleKungssButtonClick(event) {
        const clickedWord = event.currentTarget.dataset.word;
            
        kungssUserInput.push(clickedWord);
        kungssStatus.textContent = `ì…ë ¥ ì¤‘: ${kungssUserInput.length} / ${KUNGSS_SEQUENCE_LENGTH}`;

        if (kungssUserInput.length >= KUNGSS_SEQUENCE_LENGTH) {
            clearInterval(kungssTimerId);
            kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true); 

            const userInputStr = kungssUserInput.join(' | ');
            const targetStr = kungssTargetSequence.join(' | ');
                
            if (userInputStr === targetStr) {
                kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">âœ… ë¼ìš´ë“œ ${kungssCurrentRound} ì„±ê³µ!</span>`;
                kungssTarget.textContent = 'ì •ë‹µ ì‹œí€€ìŠ¤ ì…ë ¥ ì„±ê³µ!';
                setTimeout(runKungssRound, 1500); 
            } else {
                failKungssGame(`í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ "${targetStr}"ì˜€ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì…ë ¥ì€ "${userInputStr}"ì˜€ìŠµë‹ˆë‹¤.`);
            }
        }
    }

    function failKungssGame(message) {
        clearInterval(kungssTimerId);
        kungssStatus.innerHTML = `<span style="color: red; font-weight: bold;">ğŸ˜­ ê²Œì„ ì‹¤íŒ¨</span>`;
        kungssTarget.textContent = message;
        kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true);
        setTimeout(resetKungssGame, 3000); 
    }

    // ========================================================
    // VII. âš”ï¸ ê°•í™” ì‹œìŠ¤í…œ ë¡œì§
    // ========================================================

    function getSwordName(level) {
        if (level === 0) return "ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)";
        if (level >= 100) return ENHANCEMENT_STATS[100].name;
        // 1~99ê°•
        return ENHANCEMENT_STATS[level].name;
    }

    function updateEnhanceButtonText() {
        const isProtected = protectionCheckbox.checked;
        let cost = ENHANCE_COST;
        if (isProtected) {
            cost += PROTECTION_COST;
        }
        enhanceButton.textContent = `ê°•í™” ì‹œë„ (${cost} ì½”ì¸)`;
    }

    function updateEnhancementUI() {
        const level = userState.swordLevel;
        currentSwordLevel.textContent = level;
        currentSwordName.textContent = getSwordName(level);
        
        const targetLevel = level + 1;
        if (targetLevel > 100) {
            nextSwordLevel.textContent = "MAX";
            nextSuccessRate.textContent = "0";
            nextDestroyRate.textContent = "0";
            enhanceButton.disabled = true;
            enhanceButton.textContent = "ìµœëŒ€ ê°•í™” ë‹¬ì„±";
            enhanceResult.style.color = 'blue';
            enhanceResult.textContent = "ìµœê³  ë ˆë²¨ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!";
            protectionCheckbox.disabled = true;
            protectionCheckbox.checked = false;
        } else {
            const stats = ENHANCEMENT_STATS[targetLevel];
            nextSwordLevel.innerHTML = `${stats.level}ê°• (<span style="color: #00796b;">${stats.name}</span>)`;
            nextSuccessRate.textContent = stats.success;
            nextDestroyRate.textContent = stats.destroy;
            enhanceButton.disabled = false;
            protectionCheckbox.disabled = false;
            updateEnhanceButtonText();
        }
    }

    function handleEnhance() {
        const currentLevel = userState.swordLevel;
        const targetLevel = currentLevel + 1;
        if (targetLevel > 100) return;

        const isProtected = protectionCheckbox.checked;
        let totalCost = ENHANCE_COST;
        if (isProtected) {
            totalCost += PROTECTION_COST;
        }

        if (!subtractCoin(totalCost)) {
            enhanceResult.style.color = 'red';
            enhanceResult.textContent = `âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${totalCost})`;
            return;
        }

        const stats = ENHANCEMENT_STATS[targetLevel];
        const random = Math.random() * 100;

        if (random < stats.success) {
            // SUCCESS
            userState.swordLevel++;
            enhanceResult.style.color = 'green';
            enhanceResult.textContent = `ğŸ‰ ê°•í™” ì„±ê³µ! ${userState.swordLevel}ê°• (${ENHANCEMENT_STATS[userState.swordLevel].name}) ë‹¬ì„±!`;
        } else if (random < (stats.success + stats.destroy)) {
            // DESTROYED
            if (isProtected) {
                enhanceResult.style.color = '#f57f17'; // 'ë³´í˜¸' ì£¼í™©ìƒ‰
                enhanceResult.textContent = `ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ ë°œë™! ê°•í™” ë‹¨ê³„ê°€ ìœ ì§€ë©ë‹ˆë‹¤.`;
                // Level stays the same
            } else {
                userState.swordLevel = 0; // Reset to 0
                enhanceResult.style.color = 'red';
                enhanceResult.textContent = `ğŸ’¥ íŒŒ.ê´´.!! ê²€ì´ íŒŒê´´ë˜ì–´ 0ê°•ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤...`;
            }
        } else {
            // FAILURE (STAY)
            enhanceResult.style.color = '#e53935'; // ë‘í˜„ ë¶„ë…¸ ìƒ‰ìƒ
            enhanceResult.textContent = "â€œì™•ê´€ì´ í”ë“¤ë ¸ë‹¤â€¦ ë‘í˜„ì´ ë¶„ë…¸í•œë‹¤ğŸ’¢â€ (ê°•í™” ì‹¤íŒ¨, ë‹¨ê³„ ìœ ì§€)";
        }

        saveUserState();
        updateEnhancementUI();
        // updateCoinDisplay()ëŠ” subtractCoinì—ì„œ ì´ë¯¸ í˜¸ì¶œë©ë‹ˆë‹¤.
    }

    // ========================================================
    // [ì‹ ê·œ] VIII. âš™ï¸ ì„¤ì • (ë°±ì—…/ë³µêµ¬) ë¡œì§
    // ========================================================

    function handleBackup() {
        try {
            // í˜„ì¬ ë©”ëª¨ë¦¬ ìƒíƒœë¥¼ localStorageì— ë¨¼ì € ì €ì¥
            saveUserState(); 
            const data = localStorage.getItem(USER_STATE_KEY);
            if (data) {
                backupDataDisplay.value = data;
                settingsStatus.textContent = "âœ… ë°±ì—… ë°ì´í„° ìƒì„± ì™„ë£Œ! 'ë³µì‚¬' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
                settingsStatus.style.color = 'green';
            } else {
                throw new Error("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
        } catch (e) {
            settingsStatus.textContent = `âŒ ë°±ì—… ì‹¤íŒ¨: ${e.message}`;
            settingsStatus.style.color = 'red';
        }
    }

    function copyBackupData() {
        const data = backupDataDisplay.value;
        if (!data) {
            settingsStatus.textContent = "âŒ ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë°±ì—…ì„ ìƒì„±í•˜ì„¸ìš”.";
            settingsStatus.style.color = 'red';
            return;
        }
        
        // ìµœì‹  Clipboard API ì‚¬ìš© (ë” ì•ˆì •ì )
        navigator.clipboard.writeText(data).then(() => {
            settingsStatus.textContent = "âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!";
            settingsStatus.style.color = 'green';
        }).catch(err => {
            settingsStatus.textContent = "âŒ ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.";
            settingsStatus.style.color = 'red';
        });
    }

    function handleRestore() {
        const dataToRestore = restoreDataInput.value;
        if (!dataToRestore) {
            settingsStatus.textContent = "âŒ ë¶ˆëŸ¬ì˜¬ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.";
            settingsStatus.style.color = 'red';
            return;
        }

        if (!confirm("ì •ë§ë¡œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ì§„í–‰ ìƒí™©ì€ ëª¨ë‘ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤.")) {
            return;
        }

        try {
            const parsedData = JSON.parse(dataToRestore);

            // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (í•„ìˆ˜ í‚¤ê°€ ìˆëŠ”ì§€ í™•ì¸)
            if (parsedData.coins === undefined || parsedData.collection === undefined || parsedData.swordLevel === undefined) {
                throw new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.");
            }

            // 1. ë©”ëª¨ë¦¬(userState)ì— ë®ì–´ì“°ê¸°
            userState = parsedData;
            // 2. localStorageì— ì €ì¥
            saveUserState();
            
            // 3. UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateCoinDisplay();
            updateEnhancementUI();
            // (ì»¬ë ‰ì…˜ì€ íƒ­ ì´ë™ ì‹œ ì—…ë°ì´íŠ¸ë¨)

            settingsStatus.textContent = "âœ… ë°ì´í„° ë³µêµ¬ ì™„ë£Œ! ëª¨ë“  ë°ì´í„°ê°€ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.";
            settingsStatus.style.color = 'green';
            restoreDataInput.value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°

        } catch (e) {
            settingsStatus.textContent = `âŒ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${e.message}`;
            settingsStatus.style.color = 'red';
        }
    }

    // ========================================================
    // IX. í™”ë©´ ì „í™˜ ë° ì´ˆê¸°í™” (ê¸°ì¡´ VIII)
    // ========================================================

    function switchScreen(screenId) {
        screens.forEach(screen => { screen.classList.remove('active'); });
        const activeScreen = document.getElementById(screenId);
        if (activeScreen) { activeScreen.classList.add('active'); }

        navButtons.forEach(button => {
            button.classList.toggle('active', button.dataset.screen === screenId);
        });

        if (screenId === 'collection-screen') { displayCollection(); }
        if (screenId === 'coin-screen') { 
            initSheepGame();
            resetKungssGame(); 
        }
        // âœ… ê°•í™” í™”ë©´ìœ¼ë¡œ ì „í™˜ ì‹œ UI ì—…ë°ì´íŠ¸
        if (screenId === 'enhance-screen') {
            updateEnhancementUI();
            enhanceResult.textContent = 'ê°•í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.'; // ë©”ì‹œì§€ ì´ˆê¸°í™”
            enhanceResult.style.color = '#333';
        }
        
        // [ì¶”ê°€] ì„¤ì • í™”ë©´ìœ¼ë¡œ ì „í™˜ ì‹œ ë©”ì‹œì§€ ë° ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        if (screenId === 'settings-screen') {
            settingsStatus.textContent = "";
            backupDataDisplay.value = "";
            restoreDataInput.value = "";
        }
    }

    function handleNavClick(event) {
        const screenId = event.currentTarget.dataset.screen;
        switchScreen(screenId);
    }

    function initializeApp() {
        loadUserState();
        updateCoinDisplay();
            
        gachaButton.addEventListener('click', handleGacha); 
        document.getElementById('clear-button').addEventListener('click', clearCollection);
        startSheepBetBtn.addEventListener('click', startSheepBet);
        startKungssGameBtn.addEventListener('click', startKungssGame);
        
        // âœ… ê°•í™” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        enhanceButton.addEventListener('click', handleEnhance);
        protectionCheckbox.addEventListener('change', updateEnhanceButtonText);

        // [ì¶”ê°€] ì„¤ì • í™”ë©´ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        backupButton.addEventListener('click', handleBackup);
        copyBackupButton.addEventListener('click', copyBackupData);
        restoreButton.addEventListener('click', handleRestore);

        navButtons.forEach(button => {
            button.addEventListener('click', handleNavClick);
        });

        initSheepGame();
        initKungssGame();
        updateEnhancementUI(); // ì•± ì‹œì‘ ì‹œ ê°•í™” UI ìƒíƒœ í•œ ë²ˆ ì—…ë°ì´íŠ¸
            
        switchScreen('gacha-screen');
    }

    window.onload = initializeApp;
</script>
</body>
</html>