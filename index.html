<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‘ë¼ ê°€ì±  ì•± (ê¹€ë‘í˜„ ì»¬ë ‰ì…˜)</title>
<style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ */
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        background-color: #f4f4f9;
    }
    .container {
    background-color: #fff;
    padding: 30px 30px 100px 30px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 90%;
    max-width: 500px;
    box-sizing: border-box;
    margin-top: 20px;
}

h1 {
    color: #e53935;
    margin-top: 0;
}

/* ì½”ì¸ í‘œì‹œ ì˜ì—­ */
#coin-display {
    margin-bottom: 20px;
    padding: 10px;
    background-color: #fff8e1;
    border-radius: 8px;
    font-weight: bold;
    color: #ff9800;
    border: 1px solid #ffcc80;
}

/* ê³µí†µ í™”ë©´ ìŠ¤íƒ€ì¼ */
.screen {
    display: none;
    padding: 10px 0;
}

.screen.active {
    display: block;
}

/* ======================== ë¯¸ë‹ˆê²Œì„ ê³µí†µ ìŠ¤íƒ€ì¼ ======================== */
.game-section {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 25px;
    border-radius: 10px;
    text-align: left;
    background-color: #fcfcfc;
}
    
/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.btn-primary, .btn-game {
    padding: 10px 20px;
    font-size: 1em;
    background-color: #ffb74d;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
    width: 100%;
    box-sizing: border-box;
}
.btn-primary:hover, .btn-game:hover {
    background-color: #ffa000;
}
    
#gacha-button { width: 100%; } /* ê°€ì±  ë²„íŠ¼ì€ ë„ˆë¹„ë¥¼ 100%ë¡œ í†µì¼ */
    
/* [ì‚­ì œ] ê°€ì±  ì¿¨íƒ€ì„ í‘œì‹œ ìŠ¤íƒ€ì¼ */
/*
.cooldown-text {
    color: red;
    font-weight: bold;
    margin-top: 5px;
}
*/

/* ======================== [ì‹ ê·œ] ê°€ì±  ì• ë‹ˆë©”ì´ì…˜ ======================== */
.gacha-animation-container {
    height: 100px;
    border: 2px solid #e53935;
    background-color: #333;
    overflow: hidden;
    position: relative;
    margin: 15px 0;
    border-radius: 10px;
    display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
    box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}

/* ê°€ì§œ 'ì„ íƒ' ë¼ì¸ */
.gacha-animation-container::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background-color: rgba(255, 255, 0, 0.8);
    transform: translateY(-50%);
    z-index: 10;
}

.gacha-reel {
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease-out; /* ë¶€ë“œëŸ½ê²Œ ë©ˆì¶”ê¸° ìœ„í•œ transition */
}

.gacha-item {
    padding: 5px 10px;
    font-size: 0.9em;
    font-weight: bold;
    white-space: nowrap;
    margin: 5px 0;
    width: 80%;
    text-align: center;
    box-sizing: border-box;
    height: 26px; /* ë†’ì´ ê³ ì • */
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 5px;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes spinReel {
    from {
        transform: translateY(0);
    }
    to {
        /* (ì•„ì´í…œ ë†’ì´ 26px + ë§ˆì§„ 10px) * 50ê°œ = 1800px. ìŠ¤í¬ë¡¤í•  ì´ ë†’ì´. */
        transform: translateY(-1800px); 
    }
}

.gacha-reel.spinning {
    /* 2.5ì´ˆ ë™ì•ˆ, ê°€ì†ë„ ë¶™ë‹¤ê°€ ëŠë ¤ì§€ëŠ” íš¨ê³¼ë¡œ ìŠ¤í•€ */
    animation: spinReel 2.5s cubic-bezier(0.5, 0, 0.5, 1);
}

/* ======================== ì–‘í„¸ ë„ë°• ìŠ¤íƒ€ì¼ (ìƒëµ) ======================== */
.sheep-picker {
    display: flex;
    justify-content: space-around;
    margin: 15px 0;
}
.sheep-wool {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #333;
    cursor: pointer;
    transition: border-color 0.2s;
}
.sheep-wool.selected {
    border-color: #e53935;
    border-width: 4px;
}
.rainbow-colors {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 5px;
    margin-top: 10px;
}
.color-option {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid #ccc;
}
.color-option.active {
    border-color: #000;
    border-width: 3px;
}
.sheep-result-display {
    margin-top: 15px;
    padding: 10px;
    border: 1px dashed #777;
    border-radius: 5px;
    text-align: center;
    font-weight: bold;
}
.color-red { background-color: #e53935; }
.color-orange { background-color: #fb8c00; }
.color-yellow { background-color: #fdd835; }
.color-green { background-color: #43a047; }
.color-blue { background-color: #1e88e5; }
.color-indigo { background-color: #3949ab; }
.color-violet { background-color: #8e24aa; }

/* ======================== ì¿µì“°ì¿µì“° ìŠ¤íƒ€ì¼ ======================== */
#kungss-challenge {
    text-align: center;
}
#kungss-target {
    font-size: 1.2em; /* 3ê°œ ë‹¨ì–´ í‘œì‹œë¥¼ ìœ„í•´ í°íŠ¸ í¬ê¸° ì¡°ì • */
    font-weight: bold;
    padding: 15px;
    margin: 15px 0;
    background-color: #e8eaf6;
    border-radius: 8px;
    min-height: 40px;
}
#kungss-timer {
    font-size: 1.2em;
    color: #e53935;
    font-weight: bold;
}
#kungss-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
}
.kungss-btn {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    flex-grow: 1;
    min-width: calc(50% - 10px); /* 2ê°œì”© ë„ìš°ê¸° ìœ„í•œ ìŠ¤íƒ€ì¼ */
    box-sizing: border-box;
    font-weight: bold;
}

/* ======================== ê°•í™” ìŠ¤íƒ€ì¼ ======================== */
#sword-display {
    padding: 15px;
    background-color: #e8f5e9; /* ë¯¼ì´ˆ ëŠë‚Œ */
    border: 1px solid #a5d6a7;
    border-radius: 8px;
    margin-bottom: 20px;
}
#sword-display h3 {
    color: #00796b; /* Dark mint */
    margin: 5px 0 0 0;
}
#enhance-result {
    font-weight: bold;
    min-height: 40px;
    padding: 10px;
    border: 1px dashed #ccc;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
}
#next-level-info {
    text-align: left;
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 5px;
    border: 1px solid #eee;
}
.protection-toggle {
    margin-top: 20px;
    background-color: #fffde7;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #fff9c4;
}
.protection-toggle label {
    cursor: pointer;
    font-weight: bold;
    color: #f57f17;
}

/* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ (ê°€ì± , ì»¬ë ‰ì…˜, ë„¤ë¹„ê²Œì´ì…˜) (ìƒëµ) */
.collection-section { margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9; }
.collection-section h4 { margin-top: 0; margin-bottom: 10px; padding: 5px; background-color: #e0e0e0; border-radius: 3px; }
.collection-container { min-height: 30px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; padding: 5px; }
.character-tag { padding: 5px 10px; border-radius: 5px; font-size: 0.9em; font-weight: bold; box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1); white-space: nowrap; }
/* [ìˆ˜ì •] ê°€ì±  ì•„ì´í…œì—ë„ ì ìš©ë˜ë„ë¡ .gacha-itemì—ë„ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.rank-N, .gacha-item.rank-N { background-color: #a0a0a0; color: white; }
.rank-D, .gacha-item.rank-D { background-color: #8c8c8c; color: white; }
.rank-C, .gacha-item.rank-C { background-color: #6a6a6a; color: white; }
.rank-B, .gacha-item.rank-B { background-color: #4c4c4c; color: white; }
.rank-A, .gacha-item.rank-A { background-color: #1a1a1a; color: white; }
.rank-R, .gacha-item.rank-R { background-color: #1e88e5; color: white; }
.rank-SR, .gacha-item.rank-SR { background-color: #ffb300; color: black; border: 1px solid #ff8f00; }
.rank-SSR, .gacha-item.rank-SSR { background-color: #e53935; color: white; border: 1px solid #c62828; }
.rank-UR, .gacha-item.rank-UR { background-color: #9c27b0; color: white; border: 1px solid #7b1fa2; }
.rank-LR, .gacha-item.rank-LR { background-color: #d81b60; color: white; border: 1px solid #ad1457; }
.rank-M, .gacha-item.rank-M { background-color: #00bcd4; color: white; border: 1px solid #0097a7; }

/* --- [ì‹ ê·œ] M+ ë“±ê¸‰ ìŠ¤íƒ€ì¼ --- */
@keyframes rainbowShine {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
.rank-M-PLUS, .gacha-item.rank-M-PLUS {
    background: linear-gradient(270deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
    background-size: 400% 400%;
    animation: rainbowShine 3s ease infinite;
    color: white;
    font-weight: bold;
    border: 2px solid #fff;
    text-shadow: 0 0 5px #000, 0 0 10px #000;
}
/* --- */

.clear-btn { background-color: #bdbdbd; color: #333; border: none; padding: 8px 15px; border-radius: 5px; margin-top: 15px; cursor: pointer; font-size: 0.9em; }
.floating-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background-color: #333; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; border-top-left-radius: 10px; border-top-right-radius: 10px; }
.nav-button { background: none; border: none; color: white; font-size: 0.9em; padding: 10px 5px; cursor: pointer; flex-grow: 1; transition: color 0.2s, background-color 0.2s; display: flex; flex-direction: column; align-items: center; }
.nav-button::before { content: 'â˜…'; font-size: 1.2em; margin-bottom: 3px; }
#nav-gacha::before { content: 'ğŸ°'; } 
#nav-coin::before { content: 'ğŸ’°'; } 
#nav-collection::before { content: 'ğŸ“š'; } 
#nav-enhance::before { content: 'âš”ï¸'; } /* ê°•í™” ì•„ì´ì½˜ */
#nav-settings::before { content: 'âš™ï¸'; }
.nav-button:hover, .nav-button.active { color: #ffb74d; background-color: #444; }
.nav-button.active { font-weight: bold; }
#empty-collection-message { color: #777; text-align: center; padding: 20px; }

/* ======================== [ì¶”ê°€] ì„¤ì • í™”ë©´ ìŠ¤íƒ€ì¼ ======================== */
.settings-group {
    margin-top: 25px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #f9f9f9;
    text-align: left;
}
.settings-group h3 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}
textarea.backup-restore {
    width: 100%;
    min-height: 80px;
    box-sizing: border-box; /* ë„ˆë¹„ 100% ìœ ì§€ë¥¼ ìœ„í•´ */
    margin-top: 10px;
    font-family: monospace;
    font-size: 0.9em;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}
#settings-status {
    margin-top: 15px;
    font-weight: bold;
    min-height: 20px;
}
.btn-setting {
    padding: 8px 15px;
    font-size: 0.9em;
    background-color: #555;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
    width: auto; /* ìë™ ë„ˆë¹„ */
    margin-right: 10px; /* ë²„íŠ¼ ê°„ ê°„ê²© */
}
.btn-setting.restore {
    background-color: #e53935; /* ë¹¨ê°„ìƒ‰ */
}
.btn-setting:hover {
    background-color: #000;
}
.btn-setting.restore:hover {
    background-color: #c62828;
}

</style>
</head>
<body>
    <div class="container">
<h1>ë‘ë¼ ê°€ì± ! ğŸœ</h1>
<div id="coin-display">
    í˜„ì¬ ì½”ì¸: <span id="coin-count">500</span> ğŸª™
</div>

<div id="gacha-screen" class="screen active">
    <h2>ë‘ë¼ ë½‘ê¸° (ì½”ì¸ 250 ì†Œëª¨)</h2>
    <p>ì£¼ì¸ê³µ 'ê¹€ë‘í˜„' ìºë¦­í„°ë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</p>
    
    <div id="gacha-animation-container" class="gacha-animation-container">
        <div id="gacha-reel" class="gacha-reel"></div>
    </div>
    
    <div id="result-display" class="result-box">
        <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ë½‘ê¸°ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</p>
    </div>
    <button id="gacha-button" style="margin-bottom: 10px;">ë‘ë¼ ë½‘ê¸° (1íšŒ)</button>
    <button id="gacha-button-100k" class="btn-primary">ë‘ë¼ ë½‘ê¸° (10ë§ŒíšŒ)</button>
</div>

<div id="coin-screen" class="screen">
    <h2>ì½”ì¸ ë¯¸ë‹ˆê²Œì„</h2>

    <div id="sheep-game-section" class="game-section">
        <h3>ğŸ‘ ì–‘í„¸ ìƒ‰ê¹” ë§ì¶”ê¸° ë„ë°• (50ì½”ì¸)</h3>
        <p>ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì„ íƒí•œ ë’¤, ì–‘í„¸ 5ê°œì˜ ìƒ‰ì„ ì˜ˆì¸¡í•˜ì„¸ìš”!</p>
        <p>ì„ íƒí•œ ìƒ‰: <span id="selected-sheep-colors">ì—†ìŒ</span></p>

        <div class="sheep-picker" id="sheep-picker-area">
            </div>
            
        <div class="rainbow-colors" id="color-palette">
            </div>

        <div class="sheep-result-display" id="sheep-result">
            ë„ë°• ì‹œì‘ì„ ëˆ„ë¥´ì„¸ìš”.
        </div>
        <button id="start-sheep-bet-btn" class="btn-game">ë„ë°• ì‹œì‘! (50 ì½”ì¸)</button>
    </div>

    <div id="kungss-game-section" class="game-section">
        <h3>ğŸ¥ ê¹€ë‘í˜„ ì¿µì“°ì¿µì“° ê²Œì„ (5ì´ˆ ì œí•œ)</h3>
        <p>í™”ë©´ì— ëœ¨ëŠ” **3ê°œì˜ ë‹¨ì–´ ì‹œí€€ìŠ¤**ë¥¼ 5ì´ˆ ì•ˆì— ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ìˆœì„œëŒ€ë¡œ ì •í™•íˆ ë§ì¶”ì„¸ìš”! (3ë¼ìš´ë“œ)</p>
            
        <div id="kungss-challenge">
            <p id="kungss-status">ì¤€ë¹„</p>
            <p id="kungss-timer">ì‹œê°„: 5ì´ˆ</p>
            <div id="kungss-target">ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...</div>
                
            <div id="kungss-buttons">
                </div>
                
            <button id="start-kungss-game-btn" class="btn-game">ê²Œì„ ì‹œì‘!</button>
        </div>
    </div>
</div>

<div id="collection-screen" class="screen">
    <h2>ğŸ ë‚˜ì˜ ë‘í˜„ ì»¬ë ‰ì…˜</h2>
    <p>íšë“í•œ ëª¨ë“  ë‘í˜„ ìºë¦­í„°ë“¤ì„ ë“±ê¸‰ë³„ë¡œ í™•ì¸í•˜ì„¸ìš”!</p>
    <div id="collection-list">
        <p id="empty-collection-message">ì•„ì§ íšë“í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    <button id="clear-button" class="clear-btn">ì»¬ë ‰ì…˜ ì´ˆê¸°í™”</button>
</div>

<div id="enhance-screen" class="screen">
    <h2>âš”ï¸ ë‘í˜„ì˜ ê²€ ê°•í™”</h2>
    <p>ê²€ì„ ê°•í™”í•˜ì—¬ ë‘í˜„ì˜ í˜ì„ ê°œë°©í•˜ì„¸ìš”!</p>

    <div id="sword-display">
        <p>í˜„ì¬ ê°•í™”: <strong style="font-size: 1.2em;"><span id="current-sword-level">0</span>ê°•</strong></p>
        <h3 id="current-sword-name">ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)</h3>
    </div>

    <div id="enhance-controls">
        <div id="enhance-result">ê°•í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
        
        <div id="next-level-info" style="margin-top: 15px;">
            <p>ë‹¤ìŒ ë‹¨ê³„: <strong id="next-sword-level">1ê°•</strong></p>
            <p>ì„±ê³µ í™•ë¥ : <span id="next-success-rate">90</span>%</p>
            <p style="color: red;">íŒŒê´´ í™•ë¥ : <span id="next-destroy-rate">0</span>%</p>
        </div>

        <div class="protection-toggle">
            <input type="checkbox" id="protection-checkbox" style="vertical-align: middle;">
            <label for="protection-checkbox">íŒŒê´´ ë°©ì§€ (500 ì½”ì¸ ì¶”ê°€ ì†Œëª¨)</label>
        </div>

        <button id="enhance-button" class="btn-primary" style="margin-top: 15px; background-color: #4CAF50;">
            ê°•í™” ì‹œë„ (500 ì½”ì¸)
        </button>
    </div>
</div>

<div id="settings-screen" class="screen">
    <h2>âš™ï¸ ì•± ì„¤ì •</h2>
    
    <div class="settings-group">
        <h3>ğŸ“Š ë°ì´í„° ë°±ì—…</h3>
        <p>í˜„ì¬ ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë°±ì—…í•©ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ë¥¼ ì•ˆì „í•œ ê³³ì— ë³´ê´€í•˜ì„¸ìš”.</p>
        <button id="backup-button" class="btn-setting">1. ë°±ì—… ë°ì´í„° ìƒì„±</button>
        <button id="copy-backup-button" class="btn-setting">2. í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
        <textarea id="backup-data-display" class="backup-restore" readonly placeholder="ë°±ì—… ë°ì´í„°ë¥¼ ìƒì„±í•˜ë©´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤..."></textarea>
    </div>

    <div class="settings-group">
        <h3>ğŸ“¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</h3>
        <p>ë°±ì—…í•´ë‘” í…ìŠ¤íŠ¸ë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ê³  'ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
        <textarea id="restore-data-input" class="backup-restore" placeholder="ì´ê³³ì— ë°±ì—… ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
        <button id="restore-button" class="btn-setting restore">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <p style="font-size: 0.9em; color: red; margin-top: 10px;">
            âš ï¸ **ì£¼ì˜:** í˜„ì¬ ëª¨ë“  ì§„í–‰ ìƒí™©ì´ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤!
        </D>
    </div>
    
    <p id="settings-status" style="color: green;"></p>
</div>

</div>
<nav class="floating-nav">
    <button id="nav-gacha" class="nav-button active" data-screen="gacha-screen">ê°€ì± </button>
    <button id="nav-coin" class="nav-button" data-screen="coin-screen">ì½”ì¸ëª¨ìœ¼ê¸°</button>
    <button id="nav-collection" class="nav-button" data-screen="collection-screen">ì»¬ë ‰ì…˜</button>
    <button id="nav-enhance" class="nav-button" data-screen="enhance-screen">ê²€ê°•í™”</button>
    <button id="nav-settings" class="nav-button" data-screen="settings-screen">ì„¤ì •</button>
</nav>
<script>
    // ========================================================
    // I. ë°ì´í„° ë° ìƒìˆ˜ ì •ì˜
    // ========================================================
    const GACHA_COST = 250; 
    const DRAW_COUNT_100K = 100000; // 10ë§ŒíšŒ ë½‘ê¸° íšŸìˆ˜ [ì¶”ê°€]
    const GACHA_COST_100K = GACHA_COST * DRAW_COUNT_100K; // 25,000,000 ì½”ì¸ [ì¶”ê°€]
    const SHEEP_BET_COST = 50;
    const USER_STATE_KEY = 'doukkiUserState';
    // [ì‚­ì œ] const GACHA_COOLDOWN = 1; 

    // âœ… ê°•í™” ì‹œìŠ¤í…œ ìƒìˆ˜
    const ENHANCE_COST = 500;
    const PROTECTION_COST = 500;

    // [ìˆ˜ì •] M+ ë“±ê¸‰ì€ RARITY_ORDERì—ì„œ ì œì™¸ (ë³„ë„ ì²˜ë¦¬)
    const RARITY_ORDER = ["M", "LR", "UR", "SSR", "SR", "R", "A", "B", "C", "D", "N"];
        
    // [ìˆ˜ì •] ìºë¦­í„° ì •ì˜: probabilityëŠ” ì´ì œ ì´ ë“±ê¸‰ ë‚´ì—ì„œì˜ *ê°€ì¤‘ì¹˜*ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    const characters = [
        // [ì‹ ê·œ] M+ ë²„ê·¸ì¡ê¸° ë“±ê¸‰
        { name: "ì¹´íˆ¬ì‚¬ì—ì„œ ë²„ê·¸ ì“´ ë‚¨ì •ë„¤ ì–‘ì‹ì–´ë“¤ ì˜ì–´ë¡œ í—¤ìœ¼ì‘í•˜ê²Œ ë§Œë“œëŠ” ë‘í˜„ì´!!", rarity: "M+ë²„ê·¸ì¡ê¸°", probability: 1, colorClass: "rank-M-PLUS" },

        // M (Myth)
        { name: "ë‘í˜„, ë¯¼ì´ˆì˜ ì‹ . ë‚¨ì •ë„¤ ì—†ëŠ” ì„¸ê³„ì˜ ì°½ì¡°ì.", rarity: "M", probability: 1, colorClass: "rank-M" },

        // LR (Legendary Rare)
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼, ì™•ê´€ì´ ë°˜ì§ì´ë‹ˆê¹Œ ì‹ ì„±í™”ëœ ë‘í˜„", rarity: "LR", probability: 1, colorClass: "rank-LR" },
        { name: "ë¯¼ì´ˆë¹› ì²œì‚¬ë¡œ ìŠ¹ì²œí•œ ë‘í˜„", rarity: "LR", probability: 1, colorClass: "rank-LR" },

        // UR (Ultra Rare)
        { name: "ë²Œë ˆì™€ ë¯¼ì´ˆë¡œ ì„¸ìƒì„ êµ¬í•œ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ì™¸ëŒ€ì—ì„œ ì‹ ê²©í™”ëœ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ë¯¼íŠ¸ë¹› ë‚ ê°œ ë‹¨ ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
        { name: "ë©ì¹œê°œì™€ ì™•ê´€ ë‚˜ëˆ ì“°ëŠ” ë‘í˜„", rarity: "UR", probability: 1, colorClass: "rank-UR" },
            
        // SSR (Super Super Rare)
        { name: "ë²Œë ˆì™•êµ­ ê±´êµ­ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë¯¼ì´ˆìœ ë‹ˆë²„ìŠ¤ì˜ ì—¬ì™•", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë”ë¹™ì‡¼ì¸  1ì²œë§Œë·° ì‹ í™” ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ì´ê±´ ë‚˜ì˜ ì˜ˆìˆ ì´ë‹¤ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ë©ì¹œê°œì™€ ë“€ì—£ì†¡ ë°œë§¤ ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },
        { name: "ëŒ€êµ¬ ìƒê³µì— ì™•ê´€ ë– ìˆëŠ” ë‘í˜„", rarity: "SSR", probability: 1, colorClass: "rank-SSR" },

        // SR (Super Rare)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ë¯¼íŠ¸ë¹› ì˜¤ë¼ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë²Œë ˆë°´ë“œ ë³´ì»¬ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ì™¸ëŒ€ ì „ì„¤ì˜ ë¯¼ì´ˆì—¬ì‹  ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë©ì¹œê°œì™€ ì „í™” ì—°ê²° ì„±ê³µ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ë¼ ë²½í™” ì£¼ì¸ê³µ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë”ë¹™ì‡¼ì¸ ë¡œ ë°©ì†¡ ì¶œì—° ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë‚¨ì •ë„¤ê°€ ì‚¬ë¼ì§„ ì„¸ìƒ ê¿ˆê¾¸ëŠ” ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
        { name: "ë¯¼ì´ˆ ì„±ì§€ìˆœë¡€ ë‘í˜„", rarity: "SR", probability: 1, colorClass: "rank-SR" },
            
        // R (Rare)
        { name: "ë”ë¹™ì‡¼ì¸  100ë§Œë·° ë‹¬ì„± ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ì™¸ëŒ€ ì „ê´‘íŒ ë¯¼ì´ˆ ê´‘ê³  ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë²Œë ˆ ëŒ„ìŠ¤ ì±Œë¦°ì§€ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë©ì¹œê°œ ìƒë°©ì¤‘ ì±„íŒ… ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë‚¨ì •ë„¤ ê·¼ì²˜ ê¸ˆì§€ ë²•ì•ˆ ì œì•ˆ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ëŒ€êµ¬ ë¯¼ì´ˆ í˜ìŠ¤í‹°ë²Œ MC ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë²Œë ˆë“¤ì´ ë§Œë“  ì™•ê´€ ì“°ëŠ” ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë¯¼ì´ˆ or die ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },
        { name: "ë”ë¹™ ì¤‘ ì›ƒìŒ í„°ì§„ ë‘í˜„", rarity: "R", probability: 1, colorClass: "rank-R" },

        // A (Amazing)
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ì— ì™•ê´€ ë„ìš´ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë‚˜ëŠ” ë²Œë ˆì˜ ì—¬ì™•ì´ë‹¤ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ì™¸ëŒ€ ë¯¼ì´ˆì˜ ì „ì„¤ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë©ì¹œê°œì™€ í†µí™” ì„±ê³µ ì§ì „ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë”ë¹™ì‡¼ì¸  10ë§Œ ì¢‹ì•„ìš” ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë¯¼ì´ˆ í­í¬ ì•„ë˜ì—ì„œ ëª…ìƒí•˜ëŠ” ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë²Œë ˆ ì½”ìŠ¤í”„ë ˆ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ë‚¨ì •ë„¤ ëª©ì†Œë¦¬ ê°ì§€ ì°¨ë‹¨ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ëŒ€êµ¬ ê±°ë¦¬ ë¯¼ì´ˆ ë²„ìŠ¤ê´‘ê³  ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
        { name: "ì™•ê´€ë³´ë‹¤ ì†Œì¤‘í•œ ê±´ ìì¡´ì‹¬ ë‘í˜„", rarity: "A", probability: 1, colorClass: "rank-A" },
            
        // B (Better)
        { name: "ë¯¼ì´ˆêµ ì°½ì‹œì ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ìƒì¼ì— ì˜ìƒ í¸ì§€ ë³´ë‚´ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ê°€ ì„ ìƒë‹˜â™¡ í•˜ì í­ì£¼ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë¯¼íŠ¸ë¹› ì¡°ëª… ì•„ë˜ ì¶¤ì¶”ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë”ë¹™ì‡¼ì¸  í¸ì§‘ ì¤‘ ê³¼ëª°ì… ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ëŒ€êµ¬ì—­ ë¯¼ì´ˆ í™ë³´ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ê³ ê°œ ìˆ™ì´ë©´ ì™•ê´€ ë–¨ì–´ì ¸ìš” ëª…ì–¸ ìŠ¤í”¼ì»¤ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ì™¸ëŒ€ ì¶•ì œì—ì„œ ë²Œë ˆ í¼ë ˆì´ë“œ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë©ì¹œê°œ ì´ë¦„ ìƒˆê¸´ ëª©ê±¸ì´ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë¯¼ì´ˆ ìŒë£Œ í™ë³´ëŒ€ì‚¬ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë‚¨ì •ë„¤ ì°¨ë‹¨ ì™„ë£Œ ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },
        { name: "ë²Œë ˆì™€ ë¸Œì´ë¡œê·¸ ì°ëŠ” ë‘í˜„", rarity: "B", probability: 1, colorClass: "rank-B" },

        // C (Common+)
        { name: "ë²Œë ˆ ì¹œêµ¬ ìƒì¼ íŒŒí‹° ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë‚¨ì •ë„¤ì—ê²Œ ë¯¼ì´ˆ í­íƒ„ íˆ¬ì²™ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ì™•ê´€ì— ë¯¼ì´ˆ ì¥ì‹ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë²Œë ˆì™€ ì‚°ì±… ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë©ì¹œê°œ êµ¿ì¦ˆ ëª¨ìœ¼ëŠ” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë”ë¹™ ëŒ€ë³¸ì— í—¤ìœ¼ì‘ ê¸ˆì§€ ì ì€ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ë‘í˜„ is love ë…¸ë˜ ë¶€ë¥´ëŠ” ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },
        { name: "ì™¸ëŒ€ ìˆ˜ì—… ì¤‘ ë²Œë ˆ ìŠ¤ì¼€ì¹˜ ë‘í˜„", rarity: "C", probability: 1, colorClass: "rank-C" },

        // D (Decent)
        { name: "ëŒ€êµ¬ì—ì„œ ë©ì¹œê°œ êµ¿ì¦ˆ ì‚¬ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë²Œë ˆ ì´ëª¨í‹°ì½˜ ë§Œë“œëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë‚¨ì •ë„¤ í•„í„° ì•± ë§Œë“¤ë ¤ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë¯¼ì´ˆ ìŒë£Œìˆ˜ ë§ˆì‹œë‹¤ ê¸°ì¹¨í•˜ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ì™•ê´€ ì“°ê³  ë°¥ ë¨¹ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë”ë¹™ì‡¼ì¸  ëŒ“ê¸€ ë³´ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ì™¸ëŒ€ ìº í¼ìŠ¤ ê±·ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ê³ ê°œ ìˆ™ì—¬ ì§€í ì¤ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },
        { name: "ë©ì¹œê°œ ì‹ ê³¡ ë“£ëŠ” ë‘í˜„", rarity: "D", probability: 1, colorClass: "rank-D" },

        // N (Normal)
        { name: "ë¯¼ì´ˆë§› ì•„ì´ìŠ¤í¬ë¦¼ ë¨¹ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë”ë¹™ ì—°ìŠµí•˜ë‹¤ ì¹¨ íŠ„ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ê³ ê°œ ìˆ™ì´ì§€ ë§ˆë¼â€¦ í˜¼ì£ë§ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì»¤í”¼ ë“¤ê³  ë²„ìŠ¤ ë†“ì¹œ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë¯¼íŠ¸ìƒ‰ ìŠ¬ë¦¬í¼ ì‹ ì€ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ëŒ€êµ¬ í•˜ëŠ˜ ë°”ë¼ë³´ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë©ì¹œê°œ ë°©ì†¡ ê¸°ë‹¤ë¦¬ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë²Œë ˆì•¼ ë‚˜ ë°¥ ë¨¹ì—ˆì–´? ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì™¸ëŒ€ì—ì„œ ë²Œë ˆ í¬íš ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ì™•ê´€ ë–¨ì–´ëœ¨ë¦¬ê³  ì£¼ìš´ ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
        { name: "ë‚¨ì •ë„¤ê°€ í—¤ìœ¼ì‘ í•˜ì ê¸°ê²í•˜ëŠ” ë‘í˜„", rarity: "N", probability: 1, colorClass: "rank-N" },
    ];

    // ë“±ê¸‰ë³„ ê°€ì¤‘ì¹˜ (ê¸°ë³¸) - í•©ê³„: 1000
    // [ìˆ˜ì •] M+ ë“±ê¸‰ì€ BASE_GACHA_WEIGHTSì—ì„œ ì œì™¸ (íŠ¹ë³„ í™•ë¥  ì²˜ë¦¬)
    const BASE_GACHA_WEIGHTS = {
        "M": 1,         // 0.1%
        "LR": 4,        // 0.4%
        "UR": 10,       // 1%
        "SSR": 25,      // 2.5%
        "SR": 60,       // 6%
        "R": 100,       // 10%
        "A": 150,       // 15%
        "B": 200,       // 20%
        "C": 250,       // 25%
        "D": 150,       // 15%
        "N": 40,        // 4%
    };
    const TOTAL_BASE_WEIGHT = 1000;

    // ê°•í™” ë ˆë²¨ì— ë”°ë¥¸ ë“±ê¸‰ë³„ ë³´ë„ˆìŠ¤ í™•ë¥  (ë§ˆì¼ìŠ¤í†¤ 1ë‹¹ ì¶”ê°€ë˜ëŠ” í™•ë¥  % point)
    const ENHANCE_BONUS_RATES = {
        "M": 0.05,
        "LR": 0.1,
        "UR": 0.2,
        "SSR": 0.3,
        "SR": 0.4,
        "R": 0.5,
        "A": 0.0,
        "B": 0.0,
        "C": 0.0,
        "D": 0.0,
        "N": -0.5, // Në“±ê¸‰ì€ ë§ˆì¼ìŠ¤í†¤ë‹¹ í™•ë¥  ê°ì†Œ
    };

    // ì‚¬ìš©ì ìƒíƒœ ì €ì¥ì†Œ
    let userState = { 
        coins: 500, 
        collection: [], 
        swordLevel: 0 // âœ… ê²€ ê°•í™” ë ˆë²¨ ì¶”ê°€ 
    };
    // [ì‚­ì œ] // let isGachaOnCooldown = false; // let cooldownTimerId = null;

    // ì–‘í„¸ ë„ë°• ìƒìˆ˜
    const RAINBOW_COLORS = [
        { name: "ë¹¨ê°•", class: "color-red" },
        { name: "ì£¼í™©", class: "color-orange" },
        { name: "ë…¸ë‘", class: "color-yellow" },
        { name: "ì´ˆë¡", class: "color-green" },
        { name: "íŒŒë‘", class: "color-blue" },
        { name: "ë‚¨ìƒ‰", class: "color-indigo" },
        { name: "ë³´ë¼", class: "color-violet" }
    ];
    const SHEEP_REWARD_MAP = { 
        2: 300, 
        3: 2000, 
        4: 10000, 
        5: 100000 
    };

    // ì¿µì“°ì¿µì“° ê²Œì„ ìƒìˆ˜
    const KUNGSS_WORDS = ["ê¹€ë‘í˜„ì¿µìŠ¤", "ê¹€ë‘í˜„ê¸°ì¦ë‚˜ìš”", "ê¹€ë‘ë‹¤ë‹¤ì¿µ", "ê¹€ê¹€ë‘í˜„ê¹€ê¹€ë‘í˜„ë‘í˜„", "ë‚¨ì •ë„¤"];
    const KUNGSS_ROUNDS = 3;
    const KUNGSS_TIME_LIMIT = 5;
    const KUNGSS_REWARD = 2000;
    const KUNGSS_SEQUENCE_LENGTH = 3; 

    // ì¿µì“° ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let kungssCurrentRound = 0;
    let kungssTimerId = null;
    let kungssTargetSequence = [];
    let kungssUserInput = [];

    // âœ… ê°•í™” í™•ë¥ í‘œ (ë§ˆì¼ìŠ¤í†¤)
    // íŒŒê´´ í™•ë¥ ì„ ì„ì˜ë¡œ ì„¤ì • (ì„±ê³µë¥ ì´ ë‚®ì•„ì§ˆìˆ˜ë¡ íŒŒê´´ìœ¨ ì¦ê°€)
    const ENHANCEMENT_MILESTONES = [
        { level: 1, name: "ê¹¨ì–´ë‚˜ëŠ” ë‘í˜„ì˜ ê²€", success: 90, destroy: 0 },
        { level: 5, name: "ë²Œë ˆì˜ ì¶•ë³µì„ ë°›ì€ ê²€", success: 80, destroy: 2 },
        { level: 10, name: "ë‚¨ì •ë„¤ ì°¨ë‹¨ì˜ ê²€", success: 70, destroy: 5 },
        { level: 20, name: "ë¯¼ì´ˆì˜ ì˜¤ë¼ë¥¼ ë‹´ì€ ê²€", success: 60, destroy: 8 },
        { level: 30, name: "ì™•ê´€ê³¼ í•˜ë‚˜ëœ ê²€", success: 50, destroy: 12 },
        { level: 40, name: "ëŒ€êµ¬ ìƒê³µì— ë¹›ë‚˜ëŠ” ê²€", success: 40, destroy: 17 },
        { level: 50, name: "ì™¸ëŒ€ ì „ì„¤ì˜ ê²€", success: 30, destroy: 23 },
        { level: 60, name: "ë”ë¹™ì‡¼ì¸  ì–µëŒ€ë·° ê²€", success: 20, destroy: 30 },
        { level: 70, name: "ë©ì¹œê°œì™€ì˜ ì•½ì† ê²€", success: 10, destroy: 40 },
        { level: 80, name: "íŒŒë©¸ì„ ì´ë„ëŠ” ê²€", success: 5, destroy: 55 },
        { level: 90, name: "ê¶ê·¹ì˜ ë¯¼ì´ˆ ê²€", success: 1, destroy: 65 },
        { level: 95, name: "ë²Œë ˆì™€ í•˜ë‚˜ê°€ ëœ ë‘í˜„", success: 0.5, destroy: 70 },
        { level: 99, name: "ë¯¼ì´ˆì˜ ì‹ ì„±ê²€ â€˜ë‘ë¼ ë¸”ë ˆì´ë“œâ€™", success: 0.1, destroy: 80 },
        { level: 100, name: "ğŸŒ¿ì‹ í™”: â€œë‘í˜„, ì™•ê´€ì„ ìƒì§€ ì•Šì€ ìâ€", success: 0.01, destroy: 90 }
    ];

    // âœ… 1~100ê°• ì „ì²´ ë°ì´í„° ìƒì„±
    const ENHANCEMENT_STATS = {};
    let currentStats = { success: 100, destroy: 0 };
    let currentName = "ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)";
    for (let i = 1; i <= 100; i++) {
        const milestone = ENHANCEMENT_MILESTONES.find(m => m.level === i);
        if (milestone) {
            currentStats = { success: milestone.success, destroy: milestone.destroy };
            currentName = milestone.name;
        }
        ENHANCEMENT_STATS[i] = { level: i, name: currentName, success: currentStats.success, destroy: currentStats.destroy };
    }

    // ========================================================
    // II. DOM ìš”ì†Œ ì ‘ê·¼
    // ========================================================
    const gachaButton = document.getElementById('gacha-button'); 
    const gachaButton100k = document.getElementById('gacha-button-100k'); // [ì‹ ê·œ] 10ë§ŒíšŒ ë²„íŠ¼
    // [ì‚­ì œ] const gachaCooldownDisplay = document.getElementById('gacha-cooldown-display');
    const resultDisplay = document.getElementById('result-display');
    const collectionList = document.getElementById('collection-list');
    const coinCountElement = document.getElementById('coin-count');
    const screens = document.querySelectorAll('.screen');
    const navButtons = document.querySelectorAll('.nav-button');
    const emptyCollectionMessage = document.getElementById('empty-collection-message');

    // [ì‹ ê·œ] ê°€ì±  ì• ë‹ˆë©”ì´ì…˜ DOM (ì°¸ì¡°ëŠ” ë‚¨ê²¨ë‘ )
    const gachaAnimationContainer = document.getElementById('gacha-animation-container');
    const gachaReel = document.getElementById('gacha-reel'); 

    // ì–‘í„¸ ë„ë°• DOM
    const sheepPickerArea = document.getElementById('sheep-picker-area');
    const colorPalette = document.getElementById('color-palette');
    const startSheepBetBtn = document.getElementById('start-sheep-bet-btn');
    const sheepResult = document.getElementById('sheep-result');
    const selectedSheepColorsDisplay = document.getElementById('selected-sheep-colors');

    // ì¿µì“°ì¿µì“° DOM
    const kungssStatus = document.getElementById('kungss-status');
    const kungssTimer = document.getElementById('kungss-timer');
    const kungssTarget = document.getElementById('kungss-target');
    const kungssButtons = document.getElementById('kungss-buttons');
    const startKungssGameBtn = document.getElementById('start-kungss-game-btn');

    // ê°•í™” DOM
    const enhanceButton = document.getElementById('enhance-button');
    const currentSwordLevel = document.getElementById('current-sword-level');
    const currentSwordName = document.getElementById('current-sword-name');
    const nextSwordLevel = document.getElementById('next-sword-level');
    const nextSuccessRate = document.getElementById('next-success-rate');
    const nextDestroyRate = document.getElementById('next-destroy-rate');
    const enhanceResult = document.getElementById('enhance-result');
    const protectionCheckbox = document.getElementById('protection-checkbox');

    // ì„¤ì • DOM
    const backupButton = document.getElementById('backup-button');
    const copyBackupButton = document.getElementById('copy-backup-button');
    const restoreButton = document.getElementById('restore-button');
    const backupDataDisplay = document.getElementById('backup-data-display');
    const restoreDataInput = document.getElementById('restore-data-input');
    const settingsStatus = document.getElementById('settings-status');

    // ========================================================
    // III. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (ì½”ì¸, ì €ì¥ ë“±)
    // ========================================================

    // ìƒíƒœ ë¡œë“œ
    function loadUserState() {
        const savedState = localStorage.getItem(USER_STATE_KEY);
        if (savedState) {
            try {
                const parsedState = JSON.parse(savedState);
                // ê¸°ì¡´ stateì— ì €ì¥ëœ ë°ì´í„°ë§Œ ë®ì–´ì“°ë„ë¡ í•„í„°ë§
                userState.coins = parsedState.coins || 500;
                userState.collection = parsedState.collection || [];
                userState.swordLevel = parsedState.swordLevel || 0; // âœ… ê°•í™” ë ˆë²¨ ì¶”ê°€
            } catch (e) {
                console.error("Failed to parse user state:", e);
            }
        }
    }

    // ìƒíƒœ ì €ì¥
    function saveUserState() {
        localStorage.setItem(USER_STATE_KEY, JSON.stringify(userState));
    }

    // ì½”ì¸ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateCoinDisplay() {
        coinCountElement.textContent = userState.coins.toLocaleString('ko-KR');
    }

    // ì½”ì¸ ì¦ê°€
    function addCoin(amount) {
        userState.coins += amount;
        saveUserState();
        updateCoinDisplay();
    }

    // ì½”ì¸ ê°ì†Œ (ì„±ê³µ ì—¬ë¶€ ë°˜í™˜)
    function subtractCoin(amount) {
        if (userState.coins >= amount) {
            userState.coins -= amount;
            saveUserState();
            updateCoinDisplay();
            return true;
        }
        return false;
    }

    // ========================================================
    // IV. ê°€ì± /ì»¬ë ‰ì…˜ ë¡œì§
    // ========================================================

    // [ìˆ˜ì •] conductGacha: M+ ë“±ê¸‰ íŠ¹ë³„ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
    function conductGacha() {
        // [ì‹ ê·œ] 1. M+ ë“±ê¸‰ íŠ¹ë³„ í™•ë¥  ì²´í¬ (0.000...01%)
        // ì´ ë¡œì§ì€ ê°•í™” ë ˆë²¨(milestones) ê³„ì‚° *ì „ì—* ìˆ˜í–‰ë˜ì–´ì•¼ í•¨.
        const specialRoll = Math.random();
        const M_PLUS_PROBABILITY = 1e-26; // 1 * 10^-26 (ìš”ì²­í•˜ì‹  0.000...01%)
        if (specialRoll < M_PLUS_PROBABILITY) {
            const specialChar = characters.find(c => c.rarity === "M+ë²„ê·¸ì¡ê¸°");
            if (specialChar) {
                return specialChar; // M+ ë‹¹ì²¨! ì¦‰ì‹œ ë°˜í™˜
            }
        }

        // --- M+ ë“±ê¸‰ì´ ë‹¹ì²¨ë˜ì§€ ì•Šì€ ê²½ìš°, ê¸°ì¡´ ë¡œì§ ìˆ˜í–‰ ---
        
        // 2. í˜„ì¬ ê°•í™” ë ˆë²¨ë¡œ ë§ˆì¼ìŠ¤í†¤ ê³„ì‚°
        const milestones = Math.floor(userState.swordLevel / 20);
        let adjustedProbs = {};
        let totalAdjustedProb = 0;

        // 3. (M+ ì œì™¸) ëª¨ë“  ë“±ê¸‰ì— ëŒ€í•´ ìƒˆë¡œìš´ í™•ë¥  ê³„ì‚°
        RARITY_ORDER.forEach(rarity => {
            // 3-1. ê¸°ë³¸ í™•ë¥  (ê°€ì¤‘ì¹˜ / ì´ ê°€ì¤‘ì¹˜)
            const baseProb = (BASE_GACHA_WEIGHTS[rarity] || 0) / TOTAL_BASE_WEIGHT;
            // 3-2. ë³´ë„ˆìŠ¤ í™•ë¥  (ë“±ê¸‰ë³„ ë³´ë„ˆìŠ¤ * ë§ˆì¼ìŠ¤í†¤)
            const bonusProb = (ENHANCE_BONUS_RATES[rarity] || 0) * milestones;
            // 3-3. ìƒˆë¡œìš´ í™•ë¥  = ê¸°ë³¸ í™•ë¥  + ë³´ë„ˆìŠ¤ í™•ë¥ 
            const newProb = baseProb + bonusProb;
            adjustedProbs[rarity] = newProb;
            totalAdjustedProb += newProb; // ëª¨ë“  ìƒˆ í™•ë¥ ì˜ ì´í•© (1ì´ ë„˜ì„ ìˆ˜ ìˆìŒ)
        });

        // 4. í™•ë¥  ì •ê·œí™” (ëª¨ë“  í™•ë¥ ì˜ í•©ì´ 1ë¡œ ì¡°ì •)
        let normalizedProbs = {};
        let cumulativeProb = 0;
        RARITY_ORDER.forEach(rarity => {
            const normalized = adjustedProbs[rarity] / totalAdjustedProb;
            cumulativeProb += normalized;
            normalizedProbs[rarity] = cumulativeProb; // ëˆ„ì  í™•ë¥  ì €ì¥
        });

        // 5. ëœë¤ ê°’ìœ¼ë¡œ ìµœì¢… ë“±ê¸‰ ê²°ì •
        const roll = Math.random();
        let selectedRarity = "N"; // ê¸°ë³¸ê°’
        for (const rarity of RARITY_ORDER) {
            if (roll < normalizedProbs[rarity]) {
                selectedRarity = rarity;
                break;
            }
        }

        // 6. í•´ë‹¹ ë“±ê¸‰ ë‚´ì—ì„œ ìºë¦­í„° ëœë¤ ì„ íƒ (ê°€ì¤‘ì¹˜ 1ë¡œ ëª¨ë‘ ë™ì¼í•˜ë¯€ë¡œ ë‹¨ìˆœ ëœë¤)
        const possibleChars = characters.filter(c => c.rarity === selectedRarity);
        if (possibleChars.length > 0) {
            const randomIndex = Math.floor(Math.random() * possibleChars.length);
            return possibleChars[randomIndex];
        }

        // ë§ˆì§€ë§‰ ë³´ë£¨: N ë“±ê¸‰ ìºë¦­í„° ì¤‘ í•˜ë‚˜ ë°˜í™˜
        const fallbackChars = characters.filter(c => c.rarity === "N");
        if (fallbackChars.length > 0) {
            return fallbackChars[0];
        }

        // ë§Œì•½ì˜ ê²½ìš° ë§ˆì§€ë§‰ ìºë¦­í„° ë°˜í™˜
        return possibleChars[0]; 
    }

    // [ì‚­ì œ] startGachaCooldown í•¨ìˆ˜

    // [ì‹ ê·œ] ê°€ì±  ë¦´(ì• ë‹ˆë©”ì´ì…˜) ìƒì„± (í•¨ìˆ˜ëŠ” ë‚¨ì•„ìˆì§€ë§Œ handleGachaì—ì„œ í˜¸ì¶œ ì•ˆ í•¨)
    function setupGachaReel() {
        gachaReel.innerHTML = '';
        gachaReel.classList.remove('spinning');
        // 50ê°œì˜ ëœë¤ ì•„ì´í…œ ìƒì„±
        for (let i = 0; i < 50; i++) {
            const item = document.createElement('span');
            item.classList.add('gacha-item');
            // CSS ìŠ¤íƒ€ì¼ ì ìš©ì„ ìœ„í•´ ëœë¤ ë“±ê¸‰ ë¶€ì—¬
            const randomRarityIndex = Math.floor(Math.random() * RARITY_ORDER.length);
            const randomRarity = RARITY_ORDER[randomRarityIndex];
            item.classList.add(`rank-${randomRarity}`);
            item.textContent = `????`;
            gachaReel.appendChild(item);
        }
    }

    // [ìˆ˜ì •] handleGacha: ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ì œê±°, ì¦‰ì‹œ ë½‘ê¸°
    function handleGacha() {
        if (!subtractCoin(GACHA_COST)) {
            resultDisplay.innerHTML = `<p style="color: red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${GACHA_COST})</p>`; 
            return;
        }

        // 1. ë²„íŠ¼ ë¹„í™œì„±í™” (ë½‘ê¸° ì²˜ë¦¬ ì¤‘)
        gachaButton.disabled = true;
        gachaButton100k.disabled = true; // [ì¶”ê°€] 10ë§ŒíšŒ ë²„íŠ¼ë„ ë¹„í™œì„±í™”
        
        // [ì¶”ê°€] ê²°ê³¼ì°½ì´ í•­ìƒ ë³´ì´ë„ë¡ ë³´ì¥
        resultDisplay.style.display = 'block';

        // 2. [í•µì‹¬] ì‹¤ì œ ë½‘ê¸° ë¡œì§ì€ ë°”ë¡œ ì‹¤í–‰
        const pulledCharacter = conductGacha();

        // 3. ê²°ê³¼ ë°”ë¡œ í‘œì‹œ
        resultDisplay.innerHTML = `
             ğŸ‰ **ì¶•í•˜í•©ë‹ˆë‹¤!** ğŸ‰<br>
             <span class="character-tag ${pulledCharacter.colorClass}">${pulledCharacter.rarity}</span>
             <strong>${pulledCharacter.name}</strong>ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!
        `;

        // 4. ì»¬ë ‰ì…˜ì— ì €ì¥
        userState.collection.push(pulledCharacter.name);
        saveUserState();

        // 5. [ì¶”ê°€] ë²„íŠ¼ ì¦‰ì‹œ ë‹¤ì‹œ í™œì„±í™”
        gachaButton.disabled = false;
        gachaButton100k.disabled = false; // [ì¶”ê°€] 10ë§ŒíšŒ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
    }

    // [ì‹ ê·œ] 10ë§ŒíšŒ ë½‘ê¸° ì²˜ë¦¬ í•¨ìˆ˜
    function handleGacha100k() {
        const drawCount = DRAW_COUNT_100K;
        const totalCost = GACHA_COST_100K;
        
        if (!subtractCoin(totalCost)) {
            resultDisplay.innerHTML = `<p style="color: red;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${totalCost.toLocaleString('ko-KR')})</p>`;
            return;
        }

        // 1. ë²„íŠ¼ ë¹„í™œì„±í™” (ë½‘ê¸° ì²˜ë¦¬ ì¤‘)
        gachaButton.disabled = true;
        gachaButton100k.disabled = true;
        
        resultDisplay.style.display = 'block';
        resultDisplay.innerHTML = `<p>âœ¨ **100,000íšŒ ì—°ì† ë½‘ê¸°** ì§„í–‰ ì¤‘... (ì•½ê°„ì˜ ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>`;

        // ë¹„ë™ê¸° ì²˜ë¦¬ (UI ê°±ì‹  í›„)ë¥¼ ìœ„í•´ setTimeout ì‚¬ìš©
        setTimeout(() => {
            const results = [];
            for (let i = 0; i < drawCount; i++) {
                const pulledCharacter = conductGacha();
                results.push(pulledCharacter);
                // ì»¬ë ‰ì…˜ì— ë°”ë¡œ ì €ì¥ (ì„±ëŠ¥ì„ ìœ„í•´ 10ë§Œ ê°œë¥¼ ëª¨ë‘ ì €ì¥)
                userState.collection.push(pulledCharacter.name); 
            }

            saveUserState();

            // ê²°ê³¼ ì§‘ê³„
            const countsByRarity = results.reduce((acc, char) => {
                const rarity = char.rarity;
                acc[rarity] = (acc[rarity] || 0) + 1;
                return acc;
            }, {});

            // ê²°ê³¼ í‘œì‹œ HTML ìƒì„±
            let resultHTML = `
                <p style="font-weight: bold; margin-bottom: 5px;">ğŸ‰ **100,000íšŒ ë½‘ê¸° ê²°ê³¼ ìš”ì•½** ğŸ‰</p>
                <div style="text-align: left; padding: 10px; border: 1px solid #ffcc80; border-radius: 5px; background-color: #fff8e1;">
            `;
            
            // M+ë¥¼ ê°€ì¥ ë¨¼ì € í‘œì‹œ
            const M_PLUS_RARITY = "M+ë²„ê·¸ì¡ê¸°";
            if (countsByRarity[M_PLUS_RARITY]) {
                 resultHTML += `<p><span class="character-tag rank-M-PLUS" style="font-size: 1.1em;">${M_PLUS_RARITY}</span>: <strong>${countsByRarity[M_PLUS_RARITY].toLocaleString('ko-KR')}ê°œ íšë“! (ë²„ê·¸ì¡ê¸° ì¾Œê±°!)</strong></p>`;
                 delete countsByRarity[M_PLUS_RARITY]; // ëª©ë¡ì—ì„œ ì œê±°í•˜ì—¬ ì•„ë˜ì—ì„œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
            }
            
            // ë‚˜ë¨¸ì§€ ë“±ê¸‰ì„ RARITY_ORDER ìˆœìœ¼ë¡œ í‘œì‹œ
            RARITY_ORDER.forEach(rarity => {
                if (countsByRarity[rarity]) {
                    // í•´ë‹¹ ë“±ê¸‰ì˜ ì²« ë²ˆì§¸ ìºë¦­í„°ë¥¼ ì°¾ì•„ í´ë˜ìŠ¤ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì»¬ë ‰ì…˜ì— ì €ì¥ëœ ê²ƒì´ ì•„ë‹Œ, ìºë¦­í„° ì •ì˜ì—ì„œ)
                    const charExample = characters.find(c => c.rarity === rarity);
                    const rarityClass = charExample ? charExample.colorClass : `rank-${rarity}`; 
                    resultHTML += `<p><span class="character-tag ${rarityClass}" style="font-size: 1.1em;">${rarity}</span>: ${countsByRarity[rarity].toLocaleString('ko-KR')}ê°œ íšë“</p>`;
                    delete countsByRarity[rarity];
                }
            });

            // í˜¹ì‹œ ëª¨ë¥¼ ëˆ„ë½ëœ ë“±ê¸‰ ì²˜ë¦¬ (ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆìƒë˜ë‚˜ ì•ˆì „ì„ ìœ„í•´)
            for (const rarity in countsByRarity) {
                if (countsByRarity[rarity]) {
                    resultHTML += `<p><span>${rarity}</span>: ${countsByRarity[rarity].toLocaleString('ko-KR')}ê°œ íšë“</p>`;
                }
            }
            
            resultHTML += `</div><p style="margin-top: 10px;">**ì „ì²´ ìºë¦­í„° ${userState.collection.length.toLocaleString('ko-KR')}ê°œ!** ì»¬ë ‰ì…˜ íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>`;
            
            resultDisplay.innerHTML = resultHTML;

            // 5. ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
            gachaButton.disabled = false;
            gachaButton100k.disabled = false;
            
        }, 50); // ì§§ì€ ì§€ì—°ì‹œê°„ìœ¼ë¡œ UI ê°±ì‹  (ë½‘ê¸° ì§„í–‰ ì¤‘...) ë©”ì‹œì§€ í‘œì‹œ ê¸°íšŒ ì œê³µ
    }

    // [ìˆ˜ì •] displayCollection: M+ ë“±ê¸‰ì„ í¬í•¨í•œ ëª¨ë“  ë“±ê¸‰ì„ ë™ì ìœ¼ë¡œ í‘œì‹œ
    function displayCollection() {
        const collection = userState.collection;
        collectionList.innerHTML = '';

        if (collection.length === 0) {
            emptyCollectionMessage.style.display = 'block';
            return;
        } else {
            emptyCollectionMessage.style.display = 'none';
        }

        const countsByRarity = {};
        const charDataMap = {}; // ì´ë¦„ë³„ ìºë¦­í„° ë°ì´í„° ë§µ

        // ìºë¦­í„° ë°ì´í„° ë§µ ìƒì„±
        characters.forEach(char => {
            charDataMap[char.name] = char;
        });

        // ì»¬ë ‰ì…˜ ì¹´ìš´íŠ¸
        collection.forEach(charName => {
            const char = charDataMap[charName] || { rarity: 'ë¯¸ë¶„ë¥˜', colorClass: 'rank-N' }; 
            const rarity = char.rarity;
            countsByRarity[rarity] = countsByRarity[rarity] || { count: 0, items: [], colorClass: char.colorClass };
            countsByRarity[rarity].count++;
            if (!countsByRarity[rarity].items.includes(charName)) {
                 countsByRarity[rarity].items.push(charName);
            }
        });

        // M+ ë“±ê¸‰ì„ RARITY_ORDERì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë³„ë„ ì²˜ë¦¬í•˜ì—¬ ë¨¼ì € í‘œì‹œí•  ìˆœì„œì— ë„£ìŒ
        const displayOrder = ["M+ë²„ê·¸ì¡ê¸°", ...RARITY_ORDER].filter(rarity => countsByRarity[rarity]);
        
        displayOrder.forEach(rarity => {
            const data = countsByRarity[rarity];
            const rarityClass = data.colorClass;
            
            const section = document.createElement('div');
            section.classList.add('collection-section');
            
            const totalCount = collection.filter(name => charDataMap[name]?.rarity === rarity).length;
            
            section.innerHTML = `
                <h4><span class="character-tag ${rarityClass}">${rarity}</span> (${data.items.length}ì¢… / ${totalCount.toLocaleString('ko-KR')}ê°œ)</h4>
                <div class="collection-container"></div>
            `;
            
            const container = section.querySelector('.collection-container');
            data.items.forEach(name => {
                const tag = document.createElement('span');
                tag.classList.add('character-tag', rarityClass);
                tag.textContent = name;
                container.appendChild(tag);
            });
            
            collectionList.appendChild(section);
        });
    }

    // ì»¬ë ‰ì…˜ ì´ˆê¸°í™”
    function clearCollection() {
        if (confirm("ğŸš¨ ê²½ê³ : ì»¬ë ‰ì…˜ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ëœ ëª¨ë“  ìºë¦­í„°ì™€ ê°•í™” ë ˆë²¨ì´ ì‚­ì œë©ë‹ˆë‹¤.")) {
            userState.collection = [];
            userState.coins = 500;
            userState.swordLevel = 0; // âœ… ê°•í™” ë ˆë²¨ ì´ˆê¸°í™”
            saveUserState();
            updateCoinDisplay();
            displayCollection();
            updateEnhancementUI(); // âœ… ê°•í™” UIë„ ì—…ë°ì´íŠ¸
            document.getElementById('result-display').innerHTML = '<p>ì»¬ë ‰ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë½‘ê¸°ë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.</p>';
        }
    }

    // ========================================================
    // V. ì–‘í„¸ ë„ë°• ë¡œì§
    // ========================================================
    let userSheepPicks = new Array(5).fill(null);
    let selectedColor = RAINBOW_COLORS[0].name;

    function initSheepGame() {
        // 1. ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìƒì„±
        colorPalette.innerHTML = '';
        RAINBOW_COLORS.forEach(color => {
            const option = document.createElement('div');
            option.classList.add('color-option', color.class);
            option.dataset.color = color.name;
            option.addEventListener('click', () => {
                selectColorOption(color.name, option);
            });
            colorPalette.appendChild(option);
        });
        selectColorOption(RAINBOW_COLORS[0].name, colorPalette.firstChild);

        // 2. ì–‘í„¸ í”½ì»¤ ìƒì„±
        sheepPickerArea.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const sheep = document.createElement('div');
            sheep.classList.add('sheep-wool');
            sheep.dataset.index = i;
            sheep.addEventListener('click', () => {
                selectSheepColor(i, sheep);
            });
            sheepPickerArea.appendChild(sheep);
        }

        // 3. ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
        userSheepPicks.fill(null);
        updateSheepDisplay();
        sheepResult.textContent = 'ë¬´ì§€ê°œìƒ‰ ì¤‘ 5ê°€ì§€ ìƒ‰ì„ ì–‘í„¸ì— ì„ íƒí•´ ì£¼ì„¸ìš”.';
    }

    function selectColorOption(colorName, element) {
        document.querySelectorAll('.color-option').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        selectedColor = colorName;
    }

    function selectSheepColor(index, sheepElement) {
        userSheepPicks[index] = selectedColor;
        sheepElement.className = 'sheep-wool selected';
        const colorData = RAINBOW_COLORS.find(c => c.name === selectedColor);
        if (colorData) {
            sheepElement.classList.add(colorData.class);
        }
        updateSheepDisplay();
    }

    function updateSheepDisplay() {
        const displayNames = userSheepPicks.map(name => name ? name : '??');
        selectedSheepColorsDisplay.textContent = displayNames.join(', ');
        // 5ê°œ ëª¨ë‘ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
        const allSelected = userSheepPicks.every(name => name !== null);
        startSheepBetBtn.disabled = !allSelected;
        if (allSelected) {
            startSheepBetBtn.textContent = `ë„ë°• ì‹œì‘! (${SHEEP_BET_COST} ì½”ì¸)`;
        } else {
            startSheepBetBtn.textContent = `ì–‘í„¸ 5ê°œë¥¼ ëª¨ë‘ ì„ íƒí•˜ì„¸ìš”.`;
        }
    }

    function startSheepBet() {
        if (!userSheepPicks.every(name => name !== null)) {
            alert("5ê°€ì§€ ìƒ‰ì„ ëª¨ë‘ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        if (!subtractCoin(SHEEP_BET_COST)) {
            sheepResult.innerHTML = `<span style="color: red; font-weight: bold;">âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${SHEEP_BET_COST})</span>`;
            return;
        }

        startSheepBetBtn.disabled = true;
        sheepResult.textContent = 'ë‘í˜„ì´ê°€ ì–‘í„¸ì„ ê¹ëŠ” ì¤‘...';
        
        // ê²°ê³¼ ìƒì„±
        const randomResult = [];
        for (let i = 0; i < 5; i++) {
            const randomIndex = Math.floor(Math.random() * RAINBOW_COLORS.length);
            randomResult.push(RAINBOW_COLORS[randomIndex].name);
        }

        // ê²°ê³¼ ë¹„êµ
        let correctCount = 0;
        for (let i = 0; i < 5; i++) {
            if (userSheepPicks[i] === randomResult[i]) {
                correctCount++;
            }
        }

        // ê²°ê³¼ í‘œì‹œ ë° ë³´ìƒ ì§€ê¸‰
        let resultText = `<br><span style="font-weight: bold;">[ê²°ê³¼]</span> ì˜ˆì¸¡: ${userSheepPicks.join(', ')} | ì‹¤ì œ: ${randomResult.join(', ')}<br>
                        <span style="font-weight: bold;">ì •ë‹µ ê°œìˆ˜: ${correctCount}ê°œ</span>`;

        const reward = SHEEP_REWARD_MAP[correctCount];

        if (reward) {
            addCoin(reward);
            resultText = `<span style="color: blue; font-weight: bold;">ğŸŒŸ ìŠ¹ë¦¬! ${reward.toLocaleString('ko-KR')} ì½”ì¸ íšë“! (í˜„ì¬ ${userState.coins.toLocaleString('ko-KR')})</span>`;
        } else {
            resultText = `<span style="color: red; font-weight: bold;">ğŸ˜­ íŒ¨ë°°! ${SHEEP_BET_COST} ì½”ì¸ì„ ìƒì—ˆìŠµë‹ˆë‹¤. (í˜„ì¬ ${userState.coins.toLocaleString('ko-KR')})</span>`;
        }

        sheepResult.innerHTML += resultText;

        // ì–‘í„¸ ì‹œê°ì  ì—…ë°ì´íŠ¸
        document.querySelectorAll('.sheep-wool').forEach((sheep, index) => {
            const resultColorName = randomResult[index];
            const resultColorData = RAINBOW_COLORS.find(c => c.name === resultColorName);
            sheep.className = 'sheep-wool selected';
            sheep.classList.add(resultColorData.class);
            if (userSheepPicks[index] === randomResult[index]) {
                sheep.style.border = '4px solid gold';
            } else {
                sheep.style.border = '4px solid red';
            }
        });

        // 3ì´ˆ í›„ ì´ˆê¸°í™”
        setTimeout(() => {
            document.querySelectorAll('.sheep-wool').forEach(s => s.style.border = '2px solid #333');
            initSheepGame();
        }, 3000); 
    }

    // ========================================================
    // VI. ì¿µì“°ì¿µì“° ê²Œì„ ë¡œì§
    // ========================================================
    function initKungssGame() {
        resetKungssGame();
    }

    function resetKungssGame() {
        kungssCurrentRound = 0;
        kungssTargetSequence = [];
        kungssUserInput = [];
        kungssStatus.textContent = `ì¤€ë¹„ (ì´ ${KUNGSS_ROUNDS} ë¼ìš´ë“œ, ë‹¨ì–´ 3ê°œ ìˆœì„œ ì…ë ¥)`;
        kungssTimer.textContent = `ì‹œê°„: ${KUNGSS_TIME_LIMIT}ì´ˆ`;
        kungssTarget.textContent = 'ë‹¨ì–´ ì‹œí€€ìŠ¤ ëŒ€ê¸° ì¤‘...';
        startKungssGameBtn.disabled = false;
        kungssButtons.innerHTML = '';
    }

    function startKungssGame() {
        startKungssGameBtn.disabled = true;
        kungssCurrentRound = 0;
        runKungssRound();
    }

    function runKungssRound() {
        kungssCurrentRound++;
        if (kungssCurrentRound > KUNGSS_ROUNDS) {
            // ê²Œì„ ì„±ê³µ
            clearInterval(kungssTimerId);
            addCoin(KUNGSS_REWARD);
            kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">ğŸ‰ 3ë¼ìš´ë“œ ì„±ê³µ! ${KUNGSS_REWARD.toLocaleString('ko-KR')} ì½”ì¸ íšë“!</span>`;
            kungssTarget.textContent = 'ê²Œì„ ìŠ¹ë¦¬!';
            kungssButtons.innerHTML = '';
            setTimeout(resetKungssGame, 3000);
            return;
        }

        // ë¼ìš´ë“œ ì¤€ë¹„
        kungssUserInput = [];
        kungssStatus.textContent = `ë¼ìš´ë“œ ${kungssCurrentRound} / ${KUNGSS_ROUNDS} (ì…ë ¥ 0/${KUNGSS_SEQUENCE_LENGTH})`;
        
        // 1. ë‹¨ì–´ ì‹œí€€ìŠ¤ ìƒì„±
        kungssTargetSequence = [];
        const availableWords = [...KUNGSS_WORDS];
        for (let i = 0; i < KUNGSS_SEQUENCE_LENGTH; i++) {
            const randomIndex = Math.floor(Math.random() * availableWords.length);
            kungssTargetSequence.push(availableWords[randomIndex]);
            availableWords.splice(randomIndex, 1); // ì‚¬ìš©ëœ ë‹¨ì–´ëŠ” ì œê±° (ì„ íƒì§€ ì¤‘ë³µ ë°©ì§€)
        }
        
        // 2. ë²„íŠ¼ ìƒì„± (5ê°œ ì¤‘ 3ê°œ + ëœë¤ 2ê°œ)
        const buttonWords = [...kungssTargetSequence];
        // ì¿µì“°ì¿µì“° ê²Œì„ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë‹¨ì–´ ì¤‘ 2ê°œ ì¶”ê°€
        const allPossibleWords = [...KUNGSS_WORDS];
        const uniqueButtonWords = [...new Set(buttonWords)];
        while (uniqueButtonWords.length < 5) {
             const randomWord = allPossibleWords[Math.floor(Math.random() * allPossibleWords.length)];
             if (!uniqueButtonWords.includes(randomWord)) {
                uniqueButtonWords.push(randomWord);
             }
        }
        // ë²„íŠ¼ ìˆœì„œ ì„ê¸°
        for (let i = uniqueButtonWords.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [uniqueButtonWords[i], uniqueButtonWords[j]] = [uniqueButtonWords[j], uniqueButtonWords[i]];
        }

        kungssButtons.innerHTML = '';
        uniqueButtonWords.forEach(word => {
            const btn = document.createElement('button');
            btn.classList.add('kungss-btn');
            btn.textContent = word;
            btn.dataset.word = word;
            btn.addEventListener('click', handleKungssInput);
            kungssButtons.appendChild(btn);
        });

        // 3. íƒ€ê²Ÿ ì‹œí€€ìŠ¤ í‘œì‹œ
        kungssTarget.textContent = kungssTargetSequence.join(' | ');

        // 4. íƒ€ì´ë¨¸ ì‹œì‘
        let timeLeft = KUNGSS_TIME_LIMIT;
        kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;
        
        if (kungssTimerId) clearInterval(kungssTimerId);
        kungssTimerId = setInterval(() => {
            timeLeft--;
            kungssTimer.textContent = `ì‹œê°„: ${timeLeft}ì´ˆ`;
            if (timeLeft <= 0) {
                failKungssGame(`ì‹œê°„ ì´ˆê³¼! ì •ë‹µì€ "${kungssTargetSequence.join(' | ')}"ì˜€ìŠµë‹ˆë‹¤.`);
            }
        }, 1000);
    }

    function handleKungssInput(event) {
        if (kungssUserInput.length < KUNGSS_SEQUENCE_LENGTH) {
            const clickedWord = event.currentTarget.dataset.word;
            kungssUserInput.push(clickedWord);
            kungssStatus.textContent = `ì…ë ¥ ì¤‘: ${kungssUserInput.length} / ${KUNGSS_SEQUENCE_LENGTH}`;

            if (kungssUserInput.length >= KUNGSS_SEQUENCE_LENGTH) {
                clearInterval(kungssTimerId);
                kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true);
                
                const userInputStr = kungssUserInput.join(' | ');
                const targetStr = kungssTargetSequence.join(' | ');

                if (userInputStr === targetStr) {
                    kungssStatus.innerHTML = `<span style="color: green; font-weight: bold;">âœ… ë¼ìš´ë“œ ${kungssCurrentRound} ì„±ê³µ!</span>`;
                    kungssTarget.textContent = 'ì •ë‹µ ì‹œí€€ìŠ¤ ì…ë ¥ ì„±ê³µ!';
                    setTimeout(runKungssRound, 1500);
                } else {
                    failKungssGame(`í‹€ë ¸ìŠµë‹ˆë‹¤! ì •ë‹µì€ "${targetStr}"ì˜€ìŠµë‹ˆë‹¤. ë‹¹ì‹ ì˜ ì…ë ¥ì€ "${userInputStr}"ì˜€ìŠµë‹ˆë‹¤.`);
                }
            }
        }
    }

    function failKungssGame(message) {
        clearInterval(kungssTimerId);
        kungssStatus.innerHTML = `<span style="color: red; font-weight: bold;">ğŸ˜­ ê²Œì„ ì‹¤íŒ¨</span>`;
        kungssTarget.textContent = message;
        kungssButtons.querySelectorAll('.kungss-btn').forEach(btn => btn.disabled = true);
        setTimeout(resetKungssGame, 3000);
    }

    // ========================================================
    // VII. âš”ï¸ ê°•í™” ì‹œìŠ¤í…œ ë¡œì§
    // ========================================================

    function getSwordName(level) {
        if (level === 0) return "ë‘í˜„ì˜ ì™•ê´€ ê²€ (ë¯¼ì´ˆë¹›)";
        if (level >= 100) return ENHANCEMENT_STATS[100].name;
        // 1~99ê°•
        return ENHANCEMENT_STATS[level].name;
    }

    function updateEnhanceButtonText() {
        const isProtected = protectionCheckbox.checked;
        let cost = ENHANCE_COST;
        if (isProtected) {
            cost += PROTECTION_COST;
        }
        enhanceButton.textContent = `ê°•í™” ì‹œë„ (${cost.toLocaleString('ko-KR')} ì½”ì¸)`;
    }

    function updateEnhancementUI() {
        const level = userState.swordLevel;
        currentSwordLevel.textContent = level;
        currentSwordName.textContent = getSwordName(level);

        const targetLevel = level + 1;
        if (targetLevel > 100) {
            nextSwordLevel.textContent = "MAX";
            nextSuccessRate.textContent = "0";
            nextDestroyRate.textContent = "0";
            enhanceButton.disabled = true;
            enhanceButton.textContent = "ê°•í™” ì™„ë£Œ (MAX)";
            enhanceResult.textContent = `ì¶•í•˜í•©ë‹ˆë‹¤! ìµœì¢… ê°•í™” ë‹¨ê³„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.`;
            enhanceResult.style.color = '#9c27b0';
            return;
        }
        
        enhanceButton.disabled = false;
        
        const nextStats = ENHANCEMENT_STATS[targetLevel];
        nextSwordLevel.textContent = targetLevel;
        nextSuccessRate.textContent = nextStats.success.toFixed(1);
        nextDestroyRate.textContent = nextStats.destroy.toFixed(1);

        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ì²´í¬ë°•ìŠ¤ì— ë”°ë¼ ë¹„ìš© ë³€ê²½)
        updateEnhanceButtonText();
    }

    function handleEnhance() {
        const currentLevel = userState.swordLevel;
        const targetLevel = currentLevel + 1;
        
        if (targetLevel > 100) return;

        const isProtected = protectionCheckbox.checked;
        let totalCost = ENHANCE_COST;
        if (isProtected) {
            totalCost += PROTECTION_COST;
        }

        if (!subtractCoin(totalCost)) {
            enhanceResult.textContent = `âŒ ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤! (í•„ìš”: ${totalCost.toLocaleString('ko-KR')})`;
            enhanceResult.style.color = 'red';
            return;
        }

        const stats = ENHANCEMENT_STATS[targetLevel];
        const roll = Math.random() * 100;
        
        enhanceResult.style.color = '#333';
        
        // 1. ì„±ê³µ
        if (roll < stats.success) {
            userState.swordLevel = targetLevel;
            enhanceResult.style.color = '#4CAF50';
            enhanceResult.textContent = `âœ¨ ê°•í™” ì„±ê³µ! ${targetLevel}ê°• ë‹¬ì„±! ê²€ì˜ ì´ë¦„ì´ ${getSwordName(targetLevel)}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`;

        // 2. íŒŒê´´
        } else if (roll < stats.success + stats.destroy && !isProtected) {
            userState.swordLevel = 0;
            enhanceResult.style.color = '#e53935';
            enhanceResult.textContent = `ğŸ’¥ íŒŒ.ê´´.!! ê²€ì´ íŒŒê´´ë˜ì–´ 0ê°•ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤...`;
            
        // 3. íŒŒê´´ ë°©ì§€ (íŒŒê´´ í™•ë¥ ì— ê±¸ë ¸ì§€ë§Œ ë°©ì–´ë¨)
        } else if (roll < stats.success + stats.destroy && isProtected) {
            enhanceResult.style.color = '#ffb74d';
            enhanceResult.textContent = `ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ ì„±ê³µ! (500 ì½”ì¸ ì†Œëª¨). ê°•í™”ëŠ” ì‹¤íŒ¨í–ˆì§€ë§Œ ë‹¨ê³„ëŠ” ìœ ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`;

        // 4. ì‹¤íŒ¨ (ìœ ì§€)
        } else { // FAILURE (STAY)
            enhanceResult.style.color = '#e53935'; // ë‘í˜„ ë¶„ë…¸ ìƒ‰ìƒ
            enhanceResult.textContent = "â€œì™•ê´€ì´ í”ë“¤ë ¸ë‹¤â€¦ ë‘í˜„ì´ ë¶„ë…¸í•œë‹¤ğŸ’¢â€ (ê°•í™” ì‹¤íŒ¨, ë‹¨ê³„ ìœ ì§€)";
        }

        saveUserState();
        updateEnhancementUI(); 
        // updateCoinDisplay()ëŠ” subtractCoinì—ì„œ ì´ë¯¸ í˜¸ì¶œë©ë‹ˆë‹¤.
    }

    // ========================================================
    // [ì‹ ê·œ] VIII. âš™ï¸ ì„¤ì • (ë°±ì—…/ë³µêµ¬) ë¡œì§
    // ========================================================

    function handleBackup() {
        try {
            // í˜„ì¬ ë©”ëª¨ë¦¬ ìƒíƒœë¥¼ localStorageì— ë¨¼ì € ì €ì¥
            saveUserState();
            const data = localStorage.getItem(USER_STATE_KEY);
            if (data) {
                backupDataDisplay.value = data;
                settingsStatus.textContent = "âœ… ë°±ì—… ë°ì´í„° ìƒì„± ì™„ë£Œ! 'ë³µì‚¬' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
                settingsStatus.style.color = 'green';
            } else {
                throw new Error("ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
        } catch (e) {
            settingsStatus.textContent = `âŒ ë°±ì—… ì‹¤íŒ¨: ${e.message}`;
            settingsStatus.style.color = 'red';
        }
    }

    function copyBackupData() {
        const data = backupDataDisplay.value;
        if (!data) {
            settingsStatus.textContent = "âŒ ë³µì‚¬í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë°±ì—…ì„ ìƒì„±í•˜ì„¸ìš”.";
            settingsStatus.style.color = 'red';
            return;
        }
        
        // ìµœì‹  Clipboard API ì‚¬ìš© (ë” ì•ˆì •ì )
        navigator.clipboard.writeText(data).then(() => {
            settingsStatus.textContent = "í´ë¦½ë³´ë“œì— ë³µì‚¬ ì™„ë£Œ! ì•ˆì „í•œ ê³³ì— ë³´ê´€í•˜ì„¸ìš”.";
            settingsStatus.style.color = 'green';
        }).catch(err => {
            // êµ¬í˜• ë¸Œë¼ìš°ì € ë˜ëŠ” ê¶Œí•œ ë¬¸ì œ ì‹œ ëŒ€ì²´ ë¡œì§
            const textArea = document.createElement('textarea');
            textArea.value = data;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    settingsStatus.textContent = "í´ë¦½ë³´ë“œì— ë³µì‚¬ ì™„ë£Œ! (ëŒ€ì²´ ë°©ì‹)";
                    settingsStatus.style.color = 'green';
                } else {
                    settingsStatus.textContent = "âŒ ë³µì‚¬ ì‹¤íŒ¨. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.";
                    settingsStatus.style.color = 'red';
                }
            } catch (err) {
                settingsStatus.textContent = "âŒ ë³µì‚¬ ì‹¤íŒ¨. í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.";
                settingsStatus.style.color = 'red';
            }
            document.body.removeChild(textArea);
        });
    }

    function handleRestore() {
        const data = restoreDataInput.value.trim();
        if (!data) {
            settingsStatus.textContent = "âŒ ë³µì›í•  ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            settingsStatus.style.color = 'red';
            return;
        }

        try {
            const parsedData = JSON.parse(data);

            // ë°ì´í„° êµ¬ì¡° ìœ íš¨ì„± ê²€ì‚¬ (ê°„ë‹¨í•˜ê²Œ)
            if (typeof parsedData.coins !== 'number' || !Array.isArray(parsedData.collection) || typeof parsedData.swordLevel !== 'number') {
                throw new Error("ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }

            if (confirm("âš ï¸ í˜„ì¬ ì§„í–‰ ìƒí™©ì´ ì…ë ¥ëœ ë°±ì—… ë°ì´í„°ë¡œ ì™„ì „íˆ ë®ì–´ì”Œì›Œì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.setItem(USER_STATE_KEY, data);
                loadUserState(); // ë³µì›ëœ ë°ì´í„°ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateCoinDisplay();
                updateEnhancementUI();
                displayCollection();

                settingsStatus.textContent = "âœ… ë°ì´í„° ë³µì› ë° ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ!";
                settingsStatus.style.color = 'green';
                restoreDataInput.value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                // ê°€ì±  í™”ë©´ìœ¼ë¡œ ì „í™˜í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                switchScreen('gacha-screen');
                document.getElementById('result-display').innerHTML = '<p style="color: green;">ë°ì´í„° ë³µì›ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. í˜„ì¬ ìƒíƒœë¡œ ì•±ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.</p>';
            }

        } catch (e) {
            settingsStatus.textContent = `âŒ ë°ì´í„° ë³µì› ì‹¤íŒ¨: ${e.message}`;
            settingsStatus.style.color = 'red';
        }
    }

    // ========================================================
    // IX. ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    // ========================================================
    function switchScreen(screenId) {
        screens.forEach(screen => {
            screen.classList.remove('active');
        });
        document.getElementById(screenId).classList.add('active');

        navButtons.forEach(button => {
            button.classList.remove('active');
            if (button.dataset.screen === screenId) {
                button.classList.add('active');
            }
        });

        if (screenId === 'collection-screen') { displayCollection(); }
        if (screenId === 'coin-screen') { 
            initSheepGame();
            resetKungssGame(); 
        }
        // âœ… ê°•í™” í™”ë©´ìœ¼ë¡œ ì „í™˜ ì‹œ UI ì—…ë°ì´íŠ¸
        if (screenId === 'enhance-screen') {
            updateEnhancementUI();
            enhanceResult.textContent = 'ê°•í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.'; // ë©”ì‹œì§€ ì´ˆê¸°í™”
            enhanceResult.style.color = '#333';
        }

        // [ì¶”ê°€] ì„¤ì • í™”ë©´ìœ¼ë¡œ ì „í™˜ ì‹œ ë©”ì‹œì§€ ë° ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
        if (screenId === 'settings-screen') {
            settingsStatus.textContent = "";
            backupDataDisplay.value = "";
            restoreDataInput.value = "";
        }
    }

    function handleNavClick(event) {
        const screenId = event.currentTarget.dataset.screen;
        switchScreen(screenId);
    }

    function initializeApp() {
        loadUserState();
        updateCoinDisplay();
            
        gachaButton.addEventListener('click', handleGacha); 
        gachaButton100k.addEventListener('click', handleGacha100k); // [ì‹ ê·œ] 10ë§ŒíšŒ ë½‘ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('clear-button').addEventListener('click', clearCollection);
        startSheepBetBtn.addEventListener('click', startSheepBet);
        startKungssGameBtn.addEventListener('click', startKungssGame);
        
        // âœ… ê°•í™” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        enhanceButton.addEventListener('click', handleEnhance);
        protectionCheckbox.addEventListener('change', updateEnhanceButtonText);

        // [ì¶”ê°€] ì„¤ì • í™”ë©´ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        backupButton.addEventListener('click', handleBackup);
        copyBackupButton.addEventListener('click', copyBackupData);
        restoreButton.addEventListener('click', handleRestore);

        navButtons.forEach(button => {
            button.addEventListener('click', handleNavClick);
        });

        initSheepGame();
        initKungssGame();
        updateEnhancementUI(); // ì•± ì‹œì‘ ì‹œ ê°•í™” UI ìƒíƒœ í•œ ë²ˆ ì—…ë°ì´íŠ¸
            
        switchScreen('gacha-screen');
    }

    window.onload = initializeApp;
</script>
</body>
</html>